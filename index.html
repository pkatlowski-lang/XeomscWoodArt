<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- ANTI-CACHE META TAGS -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>Xeomsc FusionArt - Grawerowanie Laserowe i Drewno</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Konfiguracja Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        wood: {
                            100: '#fef3c7',
                            500: '#d97706',
                            600: '#b45309',
                            800: '#92400e',
                            900: '#78350f',
                        },
                        stone: {
                            50: '#fafaf9',
                            800: '#292524',
                            900: '#1c1917',
                            950: '#0c0a09',
                        }
                    },
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.8s ease-out forwards',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            scroll-behavior: smooth;
        }
        
        .gradient-text {
            background: linear-gradient(to right, #b45309, #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        
        .white-outline-text {
            text-shadow: 
                -1px -1px 0 #fff,  
                 1px -1px 0 #fff,
                -1px  1px 0 #fff,
                 1px  1px 0 #fff,
                 0px  0px 8px rgba(255,255,255,0.8);
        }

        .text-outline {
            text-shadow: 
                -1px -1px 2px rgba(0,0,0,0.4),  
                 1px -1px 2px rgba(0,0,0,0.4),
                -1px  1px 2px rgba(0,0,0,0.4),
                 1px  1px 2px rgba(0,0,0,0.4),
                 0px  2px 10px rgba(0,0,0,0.6);
        }

        .hero-bg {
            background-color: #fafaf9;
            background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23d6d3d1' fill-opacity='0.2' fill-rule='evenodd'%3E%3Ccircle cx='3' cy='3' r='3'/%3E%3Ccircle cx='13' cy='13' r='3'/%3E%3C/g%3E%3C/svg%3E");
        }
        
        /* UKRYWANIE ELEMENTÓW PRZEGLĄDARKI I OPERA GX */
        video::-webkit-media-controls { display: none !important; }
        video::-webkit-media-controls-enclosure { display: none !important; }
        .rgx-button-wrapper, .rgx-button-overlay, .custom-button-wrapper, .button-container, 
        #video-detach-button, #send-by-qrcode-button, #lucid-mode-button, #skip-button,
        div[class*="rgx"], div[class*="custom-button"] {
            display: none !important; opacity: 0 !important; pointer-events: none !important;
        }

        .fade-in { animation: fadeIn 0.6s ease-out forwards; opacity: 0; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .hero-slide { position: absolute; inset: 0; opacity: 0; transition: opacity 1.5s ease-in-out; z-index: 1; }
        .hero-slide.active { opacity: 1; z-index: 10; }

        .admin-controls { display: none !important; }
        body.is-admin .admin-controls { display: flex !important; }
        body.is-admin #navbar { top: 58px; }

        .admin-sidebar-item.active { background-color: #b45309; color: white; border-right: 4px solid #fff; }
        #admin-panel.hidden { display: none !important; }

        .calc-input {
            background: #1c1917; border: 1px solid #444; color: white; padding: 0.75rem;
            border-radius: 0.5rem; width: 100%; outline: none; transition: border-color 0.2s;
        }
        .calc-input:focus { border-color: #d97706; background: #292524; }
        
        .status-dot { height: 8px; width: 8px; border-radius: 50%; display: inline-block; margin-right: 6px; }
        .status-online { background-color: #22c55e; box-shadow: 0 0 8px #22c55e; }
        .status-offline { background-color: #ef4444; }
        .status-connecting { background-color: #eab308; animation: pulse 1s infinite; }

        #toast-notification {
            position: fixed; bottom: 20px; right: 20px; background-color: #22c55e; color: white;
            padding: 1rem 1.5rem; border-radius: 0.75rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transform: translateY(100px); opacity: 0; transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 9999; display: flex; align-items: center; gap: 10px; font-weight: bold;
        }
        #toast-notification.show { transform: translateY(0); opacity: 1; }

        #error-banner {
            display: none; background-color: #ef4444; color: white; padding: 10px; text-align: center;
            font-size: 12px; font-weight: bold; position: fixed; bottom: 0; left: 0; width: 100%; z-index: 10000;
        }
        
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .thumb-active { border: 2px solid #b45309; opacity: 1; transform: scale(1.05); }

        /* STYL WIADOMOŚCI */
        .message-row-wrapper {
            background-color: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 0.75rem;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .message-row-header {
            transition: background-color 0.2s;
            cursor: pointer;
            padding: 1rem;
            display: grid;
            grid-template-columns: 2fr 3fr 4fr 3fr 1fr;
            gap: 10px;
            align-items: center;
        }
        .message-row-header:hover {
            background-color: rgba(255,255,255,0.08);
        }
        .message-unread-header {
            background-color: rgba(239, 68, 68, 0.1);
            font-weight: bold;
            border-left: 4px solid #ef4444;
        }
        
        /* Akordeon wiadomości */
        .msg-body-wrapper {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, opacity 0.5s ease-in-out, padding 0.5s;
            opacity: 0;
            background-color: rgba(0,0,0,0.2);
        }
        .msg-body-wrapper.open {
            opacity: 1;
            max-height: 2000px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            display: inline-block;
            letter-spacing: 0.05em;
        }
        .status-new { background: #ef4444; color: white; }
        .status-read { background: #d97706; color: white; }
        .status-inprogress { background: #eab308; color: black; }
        .status-replied { background: #3b82f6; color: white; }
        .status-closed { background: #22c55e; color: white; }
        .status-archive { background: #57534e; color: #d6d3d1; }
        
        .notification-badge {
            position: absolute; top: -6px; right: -6px; background-color: #ef4444; color: white;
            font-size: 10px; font-weight: bold; height: 18px; min-width: 18px; padding: 0 4px;
            border-radius: 9px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2); z-index: 10;
        }

        .custom-order-item:hover img { transform: scale(1.05); }
        .selected-category-border { border-color: #b45309 !important; box-shadow: 0 0 15px rgba(180, 83, 9, 0.3); }
        
        /* Modal Potwierdzenia */
        #confirm-modal {
            background-color: rgba(0,0,0,0.85); backdrop-filter: blur(4px);
        }

        /* DRAG CURSORS */
        .cursor-grab { cursor: grab; }
        .cursor-grabbing { cursor: grabbing; user-select: none; }

        /* Style dla tabeli kalkulatora */
        .calc-table input, .calc-table select {
            background: transparent;
            color: white;
            border: 1px solid transparent;
            padding: 4px;
            width: 100%;
            border-radius: 4px;
        }
        .calc-table input:focus, .calc-table select:focus {
            border-color: #d97706;
            background: rgba(255,255,255,0.05);
            outline: none;
        }
        .calc-table th {
            text-align: left;
            padding: 12px 8px;
            font-size: 11px;
            text-transform: uppercase;
            color: #78716c;
        }
        .calc-table td {
            padding: 8px;
            border-top: 1px solid rgba(255,255,255,0.05);
        }
        /* Ukrywanie strzałek w input number */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body class="text-stone-800 bg-stone-50">

    <!-- Toast Notification -->
    <div id="toast-notification">
        <i class="fa-solid fa-check-circle"></i>
        <span id="toast-text">Zapisano zmiany w chmurze!</span>
    </div>

    <!-- Custom Confirm Modal -->
    <div id="confirm-modal" class="fixed inset-0 z-[6000] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-sm w-full text-center animate-fade-in border-2 border-wood-600">
            <div class="mb-4 text-wood-600 text-4xl"><i class="fa-solid fa-circle-question"></i></div>
            <h3 class="text-xl font-bold mb-2">Jesteś pewien?</h3>
            <p id="confirm-text" class="text-stone-500 mb-6 text-sm">Tej operacji nie można cofnąć.</p>
            <div class="flex gap-3 justify-center">
                <button onclick="closeConfirm(false)" class="px-6 py-2 rounded-xl bg-stone-200 text-stone-700 font-bold hover:bg-stone-300 transition">Nie</button>
                <button onclick="closeConfirm(true)" class="px-6 py-2 rounded-xl bg-wood-600 text-white font-bold hover:bg-wood-700 transition shadow-lg">Tak, usuń</button>
            </div>
        </div>
    </div>

    <!-- 1. EKRAN LOGOWANIA -->
    <div id="login-screen" class="fixed inset-0 z-[9999] bg-stone-900/98 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-10 text-center animate-fade-in border-4 border-wood-600">
            <div class="mb-8 inline-flex items-center justify-center w-20 h-20 rounded-full bg-wood-100 text-wood-600 text-4xl shadow-inner">
                <i class="fa-solid fa-user-lock"></i>
            </div>
            <h2 class="text-3xl font-bold text-stone-900 mb-2">Panel Administratora</h2>
            <p class="text-stone-500 mb-8 text-sm">Zaloguj się, aby zarządzać treścią strony</p>
            
            <form onsubmit="event.preventDefault(); handleLogin();" class="space-y-5 text-left">
                <div>
                    <label class="block text-xs font-bold text-stone-500 uppercase mb-1 ml-1">Login</label>
                    <input type="text" id="login-user" class="w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 focus:ring-2 focus:ring-wood-500 outline-none transition font-medium" placeholder="Login">
                </div>
                <div>
                    <label class="block text-xs font-bold text-stone-500 uppercase mb-1 ml-1">Hasło</label>
                    <input type="password" id="login-pass" class="w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 focus:ring-2 focus:ring-wood-500 outline-none transition font-medium" placeholder="Hasło">
                </div>
                <div id="login-error" class="text-red-500 text-sm hidden text-center font-bold bg-red-50 p-2 rounded-lg">
                    <i class="fa-solid fa-circle-exclamation mr-1"></i> Błędny login lub hasło!
                </div>
                <button type="submit" class="w-full bg-wood-600 text-white py-4 rounded-xl font-bold hover:bg-wood-700 transition shadow-lg transform active:scale-95">Zaloguj się</button>
            </form>
            <button onclick="exitLogin()" class="mt-8 text-sm text-stone-400 hover:text-wood-600 underline transition">Wróć do strony głównej</button>
        </div>
    </div>

    <!-- 2. PASEK ADMINA -->
    <div id="admin-bar" class="hidden bg-stone-900 text-white text-sm py-2 px-6 fixed top-0 w-full z-[150] flex justify-between items-center shadow-lg border-b border-wood-600">
        <div class="flex items-center gap-4">
            <div class="flex items-center gap-2 px-3 py-1 bg-white/5 rounded-full border border-white/10" id="db-status-indicator">
                <div id="status-dot" class="status-dot status-connecting"></div>
                <span id="status-text" class="text-xs font-bold uppercase tracking-wider text-stone-400">Łączenie...</span>
            </div>
            <button onclick="toggleAdminPanel()" class="relative bg-wood-600 hover:bg-wood-500 text-white px-4 py-2 rounded-lg text-xs font-bold transition flex items-center gap-2 shadow-md">
                <i class="fa-solid fa-gears"></i> Panel CMS
                <span id="msg-count-bar" class="notification-badge hidden">0</span>
            </button>
        </div>
        <button onclick="handleLogout()" class="text-stone-400 hover:text-white font-medium transition flex items-center gap-2 text-xs">
            <i class="fa-solid fa-power-off"></i> Wyloguj
        </button>
    </div>

    <!-- 3. NAWIGACJA STRONY -->
    <nav class="fixed w-full z-50 bg-white/95 backdrop-blur-md shadow-sm transition-all duration-300 top-0 h-24 flex items-center border-b border-stone-100" id="navbar">
        <div class="max-w-7xl mx-auto px-6 w-full flex justify-between items-center">
            <a href="#" onclick="goHome(); window.scrollTo(0,0);" class="text-2xl font-bold text-stone-900 tracking-tight flex items-center gap-2 group transition-colors" id="nav-logo">
                <div class="bg-wood-600 text-white w-10 h-10 rounded-lg flex items-center justify-center text-xl shadow-lg group-hover:bg-wood-700 transition">
                    <i class="fa-solid fa-bolt"></i>
                </div>
                <span>Xeomsc <span class="text-wood-600" id="nav-logo-accent">FusionArt</span></span>
            </a>
            
            <div class="hidden md:flex space-x-10 items-center font-medium text-stone-600" id="nav-links">
                <a href="#home" onclick="goHome()" class="hover:text-wood-600 transition">Start</a>
                <a href="#about" onclick="goHome()" class="hover:text-wood-600 transition">O ofercie</a>
                <a href="#portfolio" onclick="goHome()" class="hover:text-wood-600 transition">Nasze Produkty</a>
                <a href="#custom-orders" onclick="goHome()" class="hover:text-wood-600 transition">Zrealizowane Zlecenia</a>
                <a href="#contact" onclick="goHome()" class="px-6 py-3 bg-wood-600 text-white rounded-full hover:bg-wood-800 transition shadow-lg font-bold">Kontakt</a>
            </div>

            <div class="md:hidden flex items-center">
                <button onclick="toggleMobileMenu()" class="text-stone-800 p-2 text-2xl transition-colors" id="mobile-menu-btn">
                    <i class="fa-solid fa-bars"></i>
                </button>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div class="md:hidden hidden absolute top-24 left-0 w-full bg-white border-t border-stone-100 shadow-xl" id="mobile-menu">
            <div class="flex flex-col p-4 space-y-2 text-stone-800">
                <a href="#home" onclick="goHome(); toggleMobileMenu();" class="px-4 py-3 rounded-xl hover:bg-stone-50 font-medium">Start</a>
                <a href="#about" onclick="goHome(); toggleMobileMenu();" class="px-4 py-3 rounded-xl hover:bg-stone-50 font-medium">O ofercie</a>
                <a href="#portfolio" onclick="goHome(); toggleMobileMenu();" class="px-4 py-3 rounded-xl hover:bg-stone-50 font-medium">Nasze Produkty</a>
                <a href="#custom-orders" onclick="goHome(); toggleMobileMenu();" class="px-4 py-3 rounded-xl hover:bg-stone-50 font-medium">Zrealizowane Zlecenia</a>
                <a href="#contact" onclick="goHome(); toggleMobileMenu();" class="px-4 py-3 rounded-xl bg-wood-50 text-wood-700 font-bold">Kontakt</a>
            </div>
        </div>
    </nav>

    <!-- 4. KONTENER GŁÓWNY -->
    <div id="main-content" class="pt-24 transition-all duration-300">
        <!-- Hero Section -->
        <section id="home" class="relative h-[calc(100vh-6rem)] flex items-center hero-bg overflow-hidden pt-10">
            <div class="absolute inset-0 z-0" id="hero-carousel-container">
                <div class="w-full h-full bg-stone-200 animate-pulse"></div>
            </div>
            <div class="absolute inset-0 bg-stone-900/40 z-10"></div>
            <div class="max-w-7xl mx-auto px-6 relative z-20 w-full">
                <div class="w-full md:w-2/3 lg:w-1/2 text-center md:text-left">
                    <span class="inline-block py-2 px-5 rounded-full bg-wood-100/90 backdrop-blur text-wood-800 text-xs font-bold mb-6 border border-wood-200 uppercase tracking-widest shadow-lg">Pracownia Grawerska</span>
                    <h1 class="text-5xl md:text-7xl font-bold leading-tight mb-6 text-white text-outline">
                        <span id="hero-title-main">Precyzja Lasera,<br>Ciepło</span> 
                        <span id="hero-title-accent" class="gradient-text white-outline-text">Drewna</span>.
                    </h1>
                    <p id="hero-desc" class="text-lg md:text-xl text-white/90 mb-10 max-w-lg mx-auto md:mx-0 font-medium text-outline leading-relaxed">Witaj w Xeomsc FusionArt.</p>
                    <div class="flex flex-wrap gap-4 justify-center md:justify-start">
                        <a href="#portfolio" class="px-10 py-4 bg-wood-600 text-white rounded-full hover:bg-wood-700 hover:scale-105 transform transition shadow-xl font-bold text-center">Zobacz nasze prace</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Oferta -->
        <section id="about" class="py-24 bg-white">
            <div class="max-w-7xl mx-auto px-6 text-center">
                <h2 class="text-4xl font-bold mb-4 text-stone-900">Co oferujemy?</h2>
                <div class="w-24 h-1.5 bg-wood-600 mx-auto rounded-full mb-16 opacity-80"></div>
                <div id="about-grid" class="grid grid-cols-1 md:grid-cols-3 gap-10"></div>
            </div>
        </section>

        <!-- Nasze Produkty -->
        <section id="portfolio" class="py-24 bg-stone-50">
            <div class="max-w-7xl mx-auto px-6 text-center">
                <h2 class="text-4xl font-bold mb-4 text-stone-900">Nasze Produkty</h2>
                <div class="w-24 h-1.5 bg-wood-600 mx-auto rounded-full mb-16 opacity-80"></div>
                <p class="text-stone-400 text-sm font-bold uppercase tracking-widest mb-4">Krok 1: Wybierz Kategorię</p>
                <div class="relative group mb-12" onmouseenter="window.stopAutoScroll()" onmouseleave="window.startAutoScroll()">
                    <button onclick="scrollCategories(-1)" class="absolute left-0 top-1/2 -translate-y-1/2 z-10 bg-wood-600 text-white w-12 h-12 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity disabled:opacity-0 hover:bg-wood-700 -ml-4 flex items-center justify-center"><i class="fa-solid fa-chevron-left"></i></button>
                    <div id="main-categories-grid" class="flex overflow-x-auto gap-8 pb-8 snap-x snap-mandatory hide-scrollbar text-left px-4 cursor-grab"></div>
                    <button onclick="scrollCategories(1)" class="absolute right-0 top-1/2 -translate-y-1/2 z-10 bg-wood-600 text-white w-12 h-12 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity disabled:opacity-0 hover:bg-wood-700 -mr-4 flex items-center justify-center"><i class="fa-solid fa-chevron-right"></i></button>
                </div>
                <div id="sub-categories-container" class="hidden animate-fade-in border-t border-stone-200 pt-12">
                    <p class="text-wood-600 text-sm font-bold uppercase tracking-widest mb-4">Krok 2: Wybierz Podkategorię</p>
                    <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                        <h3 id="selected-cat-title" class="text-3xl font-bold text-stone-800"></h3>
                        <button id="btn-see-all-subcats" onclick="" class="text-wood-600 hover:text-wood-800 font-bold text-sm flex items-center gap-2 group">Zobacz wszystkie podkategorie <i class="fa-solid fa-arrow-right group-hover:translate-x-1 transition"></i></button>
                    </div>
                    <div class="relative group">
                        <button onclick="scrollSubCategories(-1)" class="absolute left-0 top-1/2 -translate-y-1/2 z-10 bg-stone-800 text-white w-12 h-12 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity disabled:opacity-0 hover:bg-wood-600 -ml-4 flex items-center justify-center"><i class="fa-solid fa-chevron-left"></i></button>
                        <div id="sub-categories-grid" class="flex overflow-x-auto gap-6 pb-6 snap-x snap-mandatory hide-scrollbar text-left px-4 cursor-grab"></div>
                        <button onclick="scrollSubCategories(1)" class="absolute right-0 top-1/2 -translate-y-1/2 z-10 bg-stone-800 text-white w-12 h-12 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity disabled:opacity-0 hover:bg-wood-600 -mr-4 flex items-center justify-center"><i class="fa-solid fa-chevron-right"></i></button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Zlecenia -->
        <section id="custom-orders" class="py-24 bg-white">
            <div class="max-w-7xl mx-auto px-6 text-center">
                <h2 class="text-4xl font-bold mb-4 text-stone-900">Zrealizowane Zlecenia</h2>
                <div class="w-24 h-1.5 bg-wood-600 mx-auto rounded-full mb-12 opacity-80"></div>
                <div class="relative group">
                    <button onclick="scrollCustomOrders(-1)" class="absolute left-0 top-1/2 -translate-y-1/2 z-10 bg-stone-800 text-white w-12 h-12 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity disabled:opacity-0 hover:bg-wood-600 -ml-4 flex items-center justify-center"><i class="fa-solid fa-chevron-left"></i></button>
                    <div id="custom-orders-carousel" class="flex overflow-x-auto gap-6 pb-8 snap-x snap-mandatory hide-scrollbar text-left px-2 cursor-grab"></div>
                    <button onclick="scrollCustomOrders(1)" class="absolute right-0 top-1/2 -translate-y-1/2 z-10 bg-stone-800 text-white w-12 h-12 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity disabled:opacity-0 hover:bg-wood-600 -mr-4 flex items-center justify-center"><i class="fa-solid fa-chevron-right"></i></button>
                </div>
                <div class="mt-8">
                    <button onclick="openCustomOrdersGallery()" class="px-8 py-3 bg-stone-100 text-stone-600 rounded-full hover:bg-stone-200 hover:text-wood-600 transition font-bold shadow-sm inline-flex items-center gap-2"><i class="fa-solid fa-grid-2"></i> Zobacz pełną galerię zleceń</button>
                </div>
            </div>
        </section>

        <!-- Kontakt -->
        <section id="contact" class="py-24 bg-stone-50">
            <div class="max-w-5xl mx-auto px-6 text-center">
                 <h2 class="text-4xl font-bold mb-6">Kontakt i Wycena</h2>
                 <p id="contact-desc" class="mb-16 text-stone-500 text-lg max-w-2xl mx-auto">Napisz do mnie, a pomogę Ci zrealizować projekt.</p>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div onclick="openGeneralContactModal()" class="flex flex-col items-center justify-center p-10 bg-white rounded-[2.5rem] border border-stone-100 hover:border-wood-600 hover:bg-wood-50 cursor-pointer transition group shadow-sm transform hover:-translate-y-1">
                        <span class="text-xs font-bold text-stone-400 uppercase tracking-widest mb-4 group-hover:text-wood-600 transition">Kliknij</span>
                        <div class="w-20 h-20 bg-stone-50 rounded-full shadow-md flex items-center justify-center text-wood-600 text-3xl mb-6 group-hover:scale-110 group-hover:bg-wood-600 group-hover:text-white transition duration-300"><i class="fa-solid fa-envelope"></i></div>
                        <span class="font-bold text-2xl text-stone-900 group-hover:text-wood-700 transition">Wyślij Wiadomość</span>
                    </div>
                    <div class="flex flex-col items-center justify-center p-10 bg-white rounded-[2.5rem] border border-stone-100 hover:border-wood-200 transition group shadow-sm">
                        <div class="w-16 h-16 bg-stone-50 rounded-full shadow-md flex items-center justify-center text-wood-600 text-2xl mb-6 group-hover:scale-110 transition"><i class="fa-solid fa-phone"></i></div>
                        <span class="text-sm font-bold text-stone-400 uppercase tracking-widest mb-2">Zadzwoń</span>
                        <span id="contact-phone" class="font-bold text-2xl text-stone-900">+48 123 456 789</span>
                    </div>
                 </div>
            </div>
        </section>

        <!-- Stopka Główna -->
        <footer class="bg-stone-950 text-stone-600 py-16 text-center text-sm border-t border-white/5">
            <div class="max-w-7xl mx-auto px-6 space-y-6 flex flex-col md:flex-row justify-between items-center">
                <div class="text-left">
                    <h2 class="text-xl font-bold text-white mb-1">Xeomsc <span class="text-wood-600">FusionArt</span></h2>
                    <p id="footer-slogan" class="text-xs mb-4">Pasja. Precyzja. Drewno.</p>
                    <div class="flex flex-wrap gap-4 text-xs font-bold uppercase tracking-wider text-stone-500">
                        <button onclick="openLegal('privacy')" class="hover:text-wood-600 transition">Polityka Prywatności</button>
                        <span class="text-stone-700">|</span>
                        <button onclick="openLegal('terms')" class="hover:text-wood-600 transition">Regulamin</button>
                    </div>
                </div>
                <p id="footer-copyright">&copy; 2024 Xeomsc FusionArt. Wszelkie prawa zastrzeżone.</p>
            </div>
        </footer>
    </div>

    <!-- WIDOKI DYNAMICZNE -->
    <div id="subcategory-view" class="hidden min-h-screen bg-white pt-20 pb-20 fade-in fixed inset-0 z-[105] overflow-y-auto">
        <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between border-b border-stone-100 mb-8 bg-white/95 backdrop-blur sticky top-0 z-50">
             <a href="#" onclick="goHome();" class="text-xl font-bold text-stone-900 flex items-center gap-2"><div class="bg-wood-600 text-white w-8 h-8 rounded-lg flex items-center justify-center text-lg"><i class="fa-solid fa-bolt"></i></div><span>Xeomsc</span></a>
             <button onclick="goHome()" class="text-stone-400 hover:text-stone-800"><i class="fa-solid fa-xmark text-2xl"></i></button>
        </div>
        <div class="max-w-7xl mx-auto px-6 pb-20">
            <button onclick="window.goBackToSubcategoryList()" class="mb-10 flex items-center gap-3 text-stone-500 hover:text-wood-600 font-bold bg-stone-50 px-6 py-3 rounded-full w-fit"><i class="fa-solid fa-arrow-left"></i> Wróć</button>
            <h2 id="subcategory-title" class="text-5xl font-bold text-stone-900 mb-12 border-b border-stone-100 pb-6">Wybierz produkt</h2>
            <div id="subcategory-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-10"></div>
        </div>
    </div>
    
    <div id="subcategories-full-view" class="hidden min-h-screen bg-white pt-20 pb-20 fade-in fixed inset-0 z-[104] overflow-y-auto">
        <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between border-b border-stone-100 mb-8 bg-white/95 backdrop-blur sticky top-0 z-50">
             <a href="#" onclick="goHome();" class="text-xl font-bold text-stone-900 flex items-center gap-2"><div class="bg-wood-600 text-white w-8 h-8 rounded-lg flex items-center justify-center text-lg"><i class="fa-solid fa-bolt"></i></div><span>Xeomsc</span></a>
             <button onclick="goHome()" class="text-stone-400 hover:text-stone-800"><i class="fa-solid fa-xmark text-2xl"></i></button>
        </div>
        <div class="max-w-7xl mx-auto px-6 pb-20">
            <button onclick="goHome()" class="mb-10 flex items-center gap-3 text-stone-500 hover:text-wood-600 font-bold bg-stone-50 px-6 py-3 rounded-full w-fit"><i class="fa-solid fa-arrow-left"></i> Wróć</button>
            <h2 id="subcategories-full-title" class="text-5xl font-bold text-stone-900 mb-4">Wszystkie kategorie</h2>
            <div id="subcategories-full-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
        </div>
    </div>

    <div id="gallery-view" class="hidden min-h-screen bg-white pt-20 pb-20 fade-in fixed inset-0 z-[110] overflow-y-auto">
        <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between border-b border-stone-100 mb-8 bg-white/95 backdrop-blur sticky top-0 z-50">
             <a href="#" onclick="goHome();" class="text-xl font-bold text-stone-900 flex items-center gap-2"><div class="bg-wood-600 text-white w-8 h-8 rounded-lg flex items-center justify-center text-lg"><i class="fa-solid fa-bolt"></i></div><span>Xeomsc</span></a>
             <button onclick="goHome()" class="text-stone-400 hover:text-stone-800"><i class="fa-solid fa-xmark text-2xl"></i></button>
        </div>
        <div class="max-w-7xl mx-auto px-6 grid grid-cols-1 lg:grid-cols-2 gap-12 items-start pb-20">
            <div class="space-y-4">
                <div class="aspect-square bg-stone-100 rounded-3xl overflow-hidden border border-stone-100 shadow-lg cursor-zoom-in relative group flex items-center justify-center" onclick="openLightbox(window.currentImgIndex)">
                    <img id="main-product-img" src="" class="w-full h-full object-contain transition duration-500">
                </div>
                <div id="product-thumbnails" class="flex gap-4 overflow-x-auto pb-2 hide-scrollbar px-1 snap-x snap-mandatory"></div>
            </div>
            <div class="space-y-8 lg:sticky lg:top-32">
                 <button id="back-to-sub-btn" class="mb-6 flex items-center gap-2 text-stone-400 hover:text-wood-600 text-sm font-bold uppercase tracking-wider transition"><i class="fa-solid fa-arrow-left"></i> Powrót do listy</button>
                 <h2 id="prod-title" class="text-4xl md:text-5xl font-bold text-stone-900 mb-2 leading-tight"></h2>
                 <span id="prod-code" class="text-sm font-mono text-stone-400"></span>
                 <div class="border-b border-stone-100 pb-8"><span id="prod-price" class="text-4xl font-bold text-wood-600"></span></div>
                 <p id="prod-desc" class="text-stone-600 leading-relaxed"></p>
                 <button id="ask-btn" class="w-full bg-wood-600 text-white py-5 rounded-2xl font-bold text-lg hover:bg-wood-700 transition shadow-xl flex items-center justify-center gap-3"><i class="fa-regular fa-comments"></i> Zapytaj o ten produkt</button>
            </div>
        </div>
    </div>

    <div id="legal-view" class="hidden min-h-screen bg-white pt-20 pb-20 fade-in fixed inset-0 z-[130] overflow-y-auto">
        <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between border-b border-stone-100 mb-8 bg-white/95 backdrop-blur sticky top-0 z-50">
            <a href="#" onclick="goHome();" class="text-xl font-bold text-stone-900 flex items-center gap-2"><span>Xeomsc Legal</span></a>
            <button onclick="closeLegal()" class="text-stone-400 hover:text-stone-800"><i class="fa-solid fa-xmark text-2xl"></i></button>
        </div>
        <div class="max-w-4xl mx-auto px-6">
            <button onclick="closeLegal()" class="mb-10 flex items-center gap-3 text-stone-500 hover:text-wood-600 font-bold bg-stone-50 px-6 py-3 rounded-full w-fit"><i class="fa-solid fa-arrow-left"></i> Powrót</button>
            <h2 id="legal-title" class="text-4xl font-bold text-stone-900 mb-8 border-b border-stone-100 pb-6"></h2>
            <div id="legal-content" class="text-stone-600 text-lg leading-relaxed whitespace-pre-wrap font-light text-justify"></div>
        </div>
    </div>
    
    <div id="custom-orders-full-view" class="hidden min-h-screen bg-white pt-20 pb-20 fade-in fixed inset-0 z-[120] overflow-y-auto">
        <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between border-b border-stone-100 mb-8 bg-white/95 backdrop-blur sticky top-0 z-50">
            <a href="#" onclick="goHome();" class="text-xl font-bold text-stone-900 flex items-center gap-2"><span>Xeomsc</span></a>
            <button onclick="goHome()" class="text-stone-400 hover:text-stone-800"><i class="fa-solid fa-xmark text-2xl"></i></button>
        </div>
        <div class="max-w-7xl mx-auto px-6 pb-20">
            <button onclick="goHome()" class="mb-10 flex items-center gap-3 text-stone-500 hover:text-wood-600 font-bold bg-stone-50 px-6 py-3 rounded-full w-fit"><i class="fa-solid fa-arrow-left"></i> Powrót</button>
            <h2 class="text-5xl font-bold text-stone-900 mb-4">Katalog Zrealizowanych Zleceń</h2>
            <div id="custom-orders-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
        </div>
    </div>

    <!-- LIGHTBOX -->
    <div id="lightbox" class="fixed inset-0 z-[5000] bg-stone-950/95 hidden flex items-center justify-center p-4 transition-opacity duration-300 opacity-0 cursor-pointer backdrop-blur-md" onclick="closeLightbox()">
        <button class="absolute top-6 right-6 text-white/50 hover:text-white transition z-[5010] p-4" onclick="closeLightbox()"><i class="fa-solid fa-xmark text-4xl"></i></button>
        <button onclick="event.stopPropagation(); changeLightboxImage(-1)" class="absolute left-4 top-1/2 -translate-y-1/2 text-white/30 hover:text-white p-6 transition z-[5010] hidden md:block hover:bg-white/5 rounded-full"><i class="fa-solid fa-chevron-left text-4xl"></i></button>
        <div class="relative max-w-7xl max-h-screen w-full flex flex-col items-center justify-center p-2" onclick="event.stopPropagation()">
            <img id="lightbox-img" src="" class="rounded-lg shadow-2xl max-h-[95vh] object-contain transition-all duration-300">
            <p id="lightbox-counter" class="text-white/40 mt-4 text-sm font-mono"></p>
            <button id="lightbox-zoom-toggle" onclick="event.stopPropagation(); window.toggleLightboxZoom()" class="hidden absolute bottom-[-40px] right-0 bg-stone-800 text-white px-4 py-2 rounded-lg text-xs font-bold border border-white/20 hover:bg-stone-700 transition"><i class="fa-solid fa-expand mr-2"></i> Rozmiar rzeczywisty</button>
        </div>
        <button onclick="event.stopPropagation(); changeLightboxImage(1)" class="absolute right-4 top-1/2 -translate-y-1/2 text-white/30 hover:text-white p-6 transition z-[5010] hidden md:block hover:bg-white/5 rounded-full"><i class="fa-solid fa-chevron-right text-4xl"></i></button>
    </div>

    <!-- MODAL FORMULARZA KONTAKTOWEGO -->
    <div id="contact-modal" class="fixed inset-0 z-[3000] bg-stone-900/80 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden animate-fade-in relative flex flex-col max-h-[90vh]">
            <div class="bg-wood-600 p-6 text-white flex justify-between items-center shrink-0">
                <h3 class="text-xl font-bold flex items-center gap-2"><i class="fa-regular fa-paper-plane"></i> Formularz zapytania</h3>
                <button onclick="closeContactModal()" class="text-white/70 hover:text-white transition p-2"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="p-6 space-y-4 overflow-y-auto">
                <input type="text" id="contact-name" class="w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3" placeholder="Twoje Imię">
                <input type="email" id="contact-email-input" class="w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3" placeholder="Twój Email">
                <div id="product-codes-section" class="hidden border-t border-b border-stone-100 py-4 my-2">
                    <label class="block text-xs font-bold text-wood-600 uppercase mb-2 ml-1">Kod Produktu</label>
                    <div id="product-codes-container" class="space-y-3"></div>
                </div>
                <div id="contact-upload-section" class="hidden border-t border-b border-stone-100 py-4 my-2">
                    <label class="block text-xs font-bold text-wood-600 uppercase mb-2 ml-1">Załącznik</label>
                    <input type="file" id="contact-file-input" accept="image/*" class="w-full text-sm">
                </div>
                <textarea id="contact-message" class="w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 h-32 resize-none" placeholder="Treść wiadomości..."></textarea>
            </div>
            <div class="p-6 border-t border-stone-100 bg-stone-50 shrink-0">
                <button onclick="submitContactForm()" id="submit-contact-btn" class="w-full bg-wood-600 text-white py-4 rounded-xl font-bold hover:bg-wood-700 transition">Wyślij zapytanie</button>
            </div>
        </div>
    </div>

    <!-- 6. PANEL ADMINISTRATORA (CMS) -->
    <div id="admin-panel" class="fixed inset-0 z-[2000] bg-stone-950/60 backdrop-blur-md hidden items-center justify-center p-4 sm:p-8">
        <div class="bg-stone-900 text-white w-full max-w-[95vw] h-full max-h-[95vh] rounded-[2rem] overflow-hidden flex flex-col md:flex-row shadow-2xl border border-white/10 ring-1 ring-white/5">
             <div class="w-full md:w-64 bg-black/40 border-r border-white/5 p-6 flex flex-col shrink-0">
                 <div class="mb-8">
                    <h2 class="text-xl font-bold text-white flex items-center gap-3">
                        <i class="fa-solid fa-screwdriver-wrench text-wood-500"></i><span>CMS Panel</span>
                    </h2>
                 </div>
                 <nav class="space-y-2 flex-1 overflow-y-auto pr-2">
                    <button onclick="switchAdminView('messages')" id="btn-messages" class="admin-sidebar-item w-full text-left px-4 py-3 rounded-xl hover:bg-white/5 transition flex items-center gap-3 font-medium text-stone-400 hover:text-white text-sm"><i class="fa-solid fa-inbox w-5"></i> Wiadomości</button>
                    <!-- PRZYCISK WYCENY -->
                    <button onclick="switchAdminView('calculator')" id="btn-calculator" class="admin-sidebar-item w-full text-left px-4 py-3 rounded-xl hover:bg-white/5 transition flex items-center gap-3 font-medium text-wood-400 hover:text-white text-sm"><i class="fa-solid fa-calculator w-5"></i> Wycena</button>
                    
                    <div class="h-px bg-white/10 my-2"></div>
                    <button onclick="switchAdminView('content')" id="btn-content" class="admin-sidebar-item w-full text-left px-4 py-3 rounded-xl hover:bg-white/5 transition flex items-center gap-3 font-medium text-stone-400 hover:text-white text-sm"><i class="fa-solid fa-pen-to-square w-5"></i> Treść Strony</button>
                    <button onclick="switchAdminView('hero-gallery')" id="btn-hero-gallery" class="admin-sidebar-item w-full text-left px-4 py-3 rounded-xl hover:bg-white/5 transition flex items-center gap-3 font-medium text-stone-400 hover:text-white text-sm"><i class="fa-solid fa-images w-5"></i> Hero</button>
                    <div class="h-px bg-white/10 my-2"></div>
                    <button onclick="switchAdminView('categories')" id="btn-categories" class="admin-sidebar-item w-full text-left px-4 py-3 rounded-xl hover:bg-white/5 transition flex items-center gap-3 font-medium text-stone-400 hover:text-white text-sm"><i class="fa-solid fa-layer-group w-5"></i> Kategorie</button>
                    <button onclick="switchAdminView('subcategories')" id="btn-subcategories" class="admin-sidebar-item w-full text-left px-4 py-3 rounded-xl hover:bg-white/5 transition flex items-center gap-3 font-medium text-stone-400 hover:text-white text-sm"><i class="fa-solid fa-folder-tree w-5"></i> Podkategorie</button>
                    <button onclick="switchAdminView('products')" id="btn-products" class="admin-sidebar-item w-full text-left px-4 py-3 rounded-xl hover:bg-white/5 transition flex items-center gap-3 font-medium text-stone-400 hover:text-white text-sm"><i class="fa-solid fa-plus-circle w-5"></i> Dodaj Produkty</button>
                    <button onclick="switchAdminView('product-list')" id="btn-product-list" class="admin-sidebar-item w-full text-left px-4 py-3 rounded-xl hover:bg-white/5 transition flex items-center gap-3 font-medium text-stone-400 hover:text-white text-sm"><i class="fa-solid fa-list-ul w-5"></i> Lista Produktów</button>
                    <div class="h-px bg-white/10 my-2"></div>
                    <button onclick="switchAdminView('custom-orders')" id="btn-custom-orders" class="admin-sidebar-item w-full text-left px-4 py-3 rounded-xl hover:bg-white/5 transition flex items-center gap-3 font-medium text-stone-400 hover:text-white text-sm"><i class="fa-solid fa-camera-retro w-5"></i> Galeria Zleceń</button>
                 </nav>
                 <button onclick="toggleAdminPanel()" class="mt-4 py-3 text-stone-500 hover:text-white transition flex items-center gap-2 text-sm border-t border-white/10 justify-center"><i class="fa-solid fa-xmark"></i> Zamknij</button>
             </div>
             <div id="admin-content-area" class="flex-1 overflow-y-auto p-4 md:p-8 bg-stone-900 relative">
                 
                 <!-- WIDOK KALKULATORA -->
                 <div id="view-calculator" class="admin-view hidden h-full flex flex-col">
                     <!-- STICKY HEADER Z USTAWIENIAMI -->
                     <div class="bg-stone-800 p-4 rounded-2xl border border-white/5 mb-6 sticky top-0 z-30 shadow-xl">
                         <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                             <h3 class="text-2xl font-bold text-white flex items-center gap-2"><i class="fa-solid fa-calculator text-wood-500"></i> Kalkulator Wycen</h3>
                             <div class="flex gap-4">
                                 <div class="bg-black/30 px-4 py-2 rounded-xl border border-white/10 flex items-center gap-2">
                                     <label class="text-[10px] text-stone-400 uppercase font-bold">Baza 3mm (zł/cm²)</label>
                                     <input id="calc-base-price" type="number" step="0.0001" class="bg-transparent text-wood-400 font-bold w-24 text-right outline-none border-b border-transparent focus:border-wood-500 transition" value="0.0038" onchange="window.recalcAll()">
                                 </div>
                                 <div class="bg-black/30 px-4 py-2 rounded-xl border border-white/10 flex items-center gap-2">
                                     <label class="text-[10px] text-stone-400 uppercase font-bold">Laser (zł/min)</label>
                                     <input id="calc-laser-cost" type="number" step="0.01" class="bg-transparent text-wood-400 font-bold w-20 text-right outline-none border-b border-transparent focus:border-wood-500 transition" value="0.50" onchange="window.recalcAll()">
                                 </div>
                             </div>
                         </div>
                     </div>

                     <!-- OBSZAR ROBOCZY: FORMULARZ + TABELA -->
                     <div class="flex-1 overflow-y-auto space-y-6">
                         <!-- Formularz Dodawania -->
                         <div class="bg-stone-800/50 p-4 rounded-2xl border border-white/5">
                             <h4 class="text-xs uppercase font-bold text-stone-500 mb-3">Nowa Pozycja</h4>
                             <div class="grid grid-cols-1 md:grid-cols-7 gap-2 items-end">
                                 <div class="md:col-span-2">
                                     <label class="text-[10px] text-stone-500 block mb-1">Nazwa Produktu</label>
                                     <input id="c-name" class="calc-input py-2 text-sm" placeholder="np. Topper">
                                 </div>
                                 <div>
                                     <label class="text-[10px] text-stone-500 block mb-1">Szer. (mm)</label>
                                     <input id="c-width" type="number" class="calc-input py-2 text-sm" placeholder="0" max="9999">
                                 </div>
                                 <div>
                                     <label class="text-[10px] text-stone-500 block mb-1">Wys. (mm)</label>
                                     <input id="c-height" type="number" class="calc-input py-2 text-sm" placeholder="0" max="9999">
                                 </div>
                                 <div>
                                     <label class="text-[10px] text-stone-500 block mb-1">Grubość</label>
                                     <select id="c-thick" class="calc-input py-2 text-sm cursor-pointer">
                                         <!-- Generowane JS 1-15 -->
                                     </select>
                                 </div>
                                 <div>
                                     <label class="text-[10px] text-stone-500 block mb-1">Czas (min)</label>
                                     <input id="c-time" type="number" class="calc-input py-2 text-sm" placeholder="0">
                                 </div>
                                 <div>
                                     <label class="text-[10px] text-stone-500 block mb-1">Marża %</label>
                                     <input id="c-margin" type="number" class="calc-input py-2 text-sm text-wood-500 font-bold" value="0" min="0" max="300">
                                 </div>
                             </div>
                             <button onclick="addValuationItem()" class="mt-4 bg-wood-600 hover:bg-wood-500 w-full py-2 rounded-lg font-bold text-sm transition shadow-lg">Dodaj do listy <i class="fa-solid fa-plus ml-1"></i></button>
                         </div>

                         <!-- Tabela Pozycji -->
                         <div class="bg-stone-800 rounded-2xl border border-white/5 overflow-hidden">
                             <div class="overflow-x-auto">
                                 <table class="w-full calc-table text-left border-collapse">
                                     <thead>
                                         <tr class="bg-black/20 border-b border-white/5">
                                             <th class="w-8 text-center"><input type="checkbox" onchange="toggleSelectAllCalc(this)" class="accent-wood-600 cursor-pointer"></th>
                                             <th class="w-48">Nazwa</th>
                                             <th class="w-20">Szer.</th>
                                             <th class="w-20">Wys.</th>
                                             <th class="w-20">Grub.</th>
                                             <th class="w-24 text-right">Mat. (zł)</th>
                                             <th class="w-20">Czas</th>
                                             <th class="w-24 text-right">Las. (zł)</th>
                                             <th class="w-24 text-right text-stone-300">Netto</th>
                                             <th class="w-20">Marża</th>
                                             <th class="w-28 text-right text-wood-400 font-bold">Brutto</th>
                                             <th class="w-10"></th>
                                         </tr>
                                     </thead>
                                     <tbody id="valuation-list-body" class="text-sm text-stone-300 divide-y divide-white/5">
                                         <!-- Wiersze generowane dynamicznie -->
                                     </tbody>
                                 </table>
                             </div>
                             
                             <!-- PUSTY STAN -->
                             <div id="valuation-empty" class="text-center py-10 text-stone-600 hidden">
                                 <i class="fa-solid fa-calculator text-4xl mb-2 opacity-50"></i>
                                 <p>Lista jest pusta. Dodaj produkty powyżej.</p>
                             </div>

                             <!-- STOPKA PODSUMOWANIA -->
                             <div class="bg-black/40 p-4 border-t border-white/5 flex flex-col md:flex-row justify-between items-center gap-4">
                                 <div class="flex items-center gap-4 text-xs font-bold uppercase text-stone-500">
                                     <span>Zaznaczone: <span id="calc-selected-count" class="text-white ml-1">0</span></span>
                                     <button onclick="deleteSelectedValuations()" class="text-red-500 hover:text-red-400 transition"><i class="fa-solid fa-trash mr-1"></i> Usuń</button>
                                 </div>
                                 
                                 <div class="flex items-center gap-6">
                                     <!-- Masowa Marża -->
                                     <div class="flex items-center gap-2 bg-stone-700/50 rounded-lg p-1 pr-3 border border-white/5">
                                         <input id="bulk-margin-input" type="number" placeholder="%" class="w-12 bg-transparent text-center text-white font-bold outline-none text-sm" min="0" max="300">
                                         <button onclick="applyBulkMargin()" class="text-[10px] uppercase font-bold text-wood-500 hover:text-white transition">Nalicz Marżę</button>
                                     </div>

                                     <div class="text-right">
                                         <div class="text-xs text-stone-500 uppercase font-bold">Suma Netto</div>
                                         <div id="total-net" class="text-lg font-mono text-stone-300">0.00 zł</div>
                                     </div>
                                     <div class="text-right">
                                         <div class="text-xs text-wood-600 uppercase font-bold">Suma Brutto</div>
                                         <div id="total-gross" class="text-2xl font-bold font-mono text-white">0.00 zł</div>
                                     </div>
                                 </div>
                             </div>
                         </div>
                         
                         <div class="flex justify-end pb-8">
                             <button onclick="saveValuationsToCloud()" class="bg-green-600 hover:bg-green-500 px-8 py-3 rounded-xl font-bold text-white transition shadow-lg flex items-center gap-2">
                                 <i class="fa-solid fa-cloud-arrow-up"></i> Zapisz wyliczenie w pamięci
                             </button>
                         </div>
                     </div>
                 </div>

                 <!-- Inne widoki Administratora -->
                 <div id="view-messages" class="admin-view hidden space-y-6">
                    <h3 class="text-3xl font-bold">Skrzynka Odbiorcza</h3>
                    <div class="bg-black/20 rounded-xl overflow-hidden border border-white/10 min-h-[200px]">
                        <div class="grid grid-cols-12 gap-2 p-4 bg-white/5 text-xs font-bold text-stone-400 uppercase tracking-wider border-b border-white/5">
                            <div class="col-span-2">Status</div><div class="col-span-3">Nadawca</div><div class="col-span-4">Email</div><div class="col-span-3 text-right">Data/Akcje</div>
                        </div>
                        <div id="messages-list" class="divide-y divide-white/5 p-4 text-stone-500 text-center">Brak wiadomości</div>
                    </div>
                 </div>
                 
                 <div id="view-content" class="admin-view hidden space-y-10"><h3 class="text-3xl font-bold mb-6">Edycja Treści</h3><div class="space-y-6"><div><label class="block text-xs font-bold text-stone-500 mb-2">Nagłówek Hero (Linia 1)</label><input id="edit-hero-main" class="calc-input"></div><div><label class="block text-xs font-bold text-stone-500 mb-2">Nagłówek Hero (Akcent)</label><input id="edit-hero-accent" class="calc-input text-wood-500"></div><div><label class="block text-xs font-bold text-stone-500 mb-2">Opis Hero</label><textarea id="edit-hero-desc" class="calc-input h-24"></textarea></div><div class="border-t border-white/5 pt-6"></div><div><label class="block text-xs font-bold text-stone-500 mb-2">Email Kontaktowy</label><input id="edit-contact-email" class="calc-input"></div><div><label class="block text-xs font-bold text-stone-500 mb-2">Telefon</label><input id="edit-contact-phone" class="calc-input"></div><div><label class="block text-xs font-bold text-stone-500 mb-2">Opis w sekcji Kontakt</label><textarea id="edit-contact-desc" class="calc-input h-24"></textarea></div><div class="border-t border-white/5 pt-6"><h4 class="text-xl font-bold mb-4 text-wood-500">Dokumenty Prawne</h4><div class="space-y-4"><div><label class="block text-xs font-bold text-stone-500 mb-2">Polityka Prywatności</label><textarea id="edit-privacy" class="calc-input h-48 font-mono text-xs"></textarea></div><div><label class="block text-xs font-bold text-stone-500 mb-2">Regulamin</label><textarea id="edit-terms" class="calc-input h-48 font-mono text-xs"></textarea></div></div></div><div class="border-t border-white/5 pt-6"><h4 class="text-xl font-bold mb-4 text-wood-500">Stopka</h4><div class="space-y-4"><div><label class="block text-xs font-bold text-stone-500 mb-2">Slogan</label><input id="edit-footer-slogan" class="calc-input"></div><div><label class="block text-xs font-bold text-stone-500 mb-2">Copyright</label><input id="edit-footer-copyright" class="calc-input"></div></div></div><div><label class="block text-xs font-bold text-stone-500 mb-2">Klucz API ImgBB</label><input id="edit-imgbb-key" type="password" class="calc-input"></div><button onclick="saveContentSettings()" class="bg-wood-600 hover:bg-wood-500 px-8 py-3 rounded-xl font-bold transition">Zapisz Zmiany</button></div></div>
                 
                 <!-- UZUPEŁNIONE WIDOKI (Wcześniej puste) -->
                 <div id="view-hero-gallery" class="admin-view hidden space-y-8">
                     <h3 class="text-3xl font-bold">Hero Slider</h3>
                     <div class="bg-stone-800 p-6 rounded-xl border border-white/5">
                         <label class="block text-xs font-bold text-stone-500 mb-2">Dodaj URL obrazka</label>
                         <div class="flex gap-2">
                             <input id="new-hero-img" class="calc-input" placeholder="https://...">
                             <button onclick="addHeroImage()" class="bg-wood-600 px-4 rounded-lg font-bold text-white">Dodaj</button>
                         </div>
                     </div>
                 </div>

                 <div id="view-categories" class="admin-view hidden space-y-8">
                     <h3 class="text-3xl font-bold">Kategorie Główne</h3>
                     <div class="bg-stone-800 p-6 rounded-xl border border-white/5">
                         <p class="text-stone-500 text-sm mb-4">Tutaj możesz zarządzać kategoriami widocznymi na stronie głównej.</p>
                         <button onclick="showToast('Funkcja w przygotowaniu')" class="bg-stone-700 px-4 py-2 rounded-lg text-white text-sm">Dodaj nową kategorię</button>
                     </div>
                 </div>

                 <div id="view-subcategories" class="admin-view hidden space-y-8">
                     <h3 class="text-3xl font-bold">Podkategorie</h3>
                     <div class="bg-stone-800 p-6 rounded-xl border border-white/5">
                         <p class="text-stone-500 text-sm">Zarządzanie podkategoriami.</p>
                     </div>
                 </div>

                 <div id="view-products" class="admin-view hidden space-y-8">
                     <h3 class="text-3xl font-bold">Dodaj Produkt</h3>
                     <div class="bg-stone-800 p-6 rounded-xl border border-white/5 space-y-4">
                         <input class="calc-input" placeholder="Nazwa produktu">
                         <input class="calc-input" placeholder="Cena">
                         <textarea class="calc-input" placeholder="Opis"></textarea>
                         <button onclick="showToast('Produkt dodany (demo)')" class="bg-wood-600 w-full py-3 rounded-xl font-bold text-white">Zapisz Produkt</button>
                     </div>
                 </div>
                 
                 <div id="view-product-list" class="admin-view hidden space-y-8">
                     <h3 class="text-3xl font-bold">Lista Produktów</h3>
                     <p class="text-stone-500">Brak produktów w bazie.</p>
                 </div>

                 <div id="view-custom-orders" class="admin-view hidden space-y-8"><h3 class="text-3xl font-bold mb-6">Galeria Zleceń</h3><div class="bg-stone-800 p-6 rounded-3xl border border-white/5 mb-8"><label class="block text-xs font-bold text-stone-500 uppercase mb-2">Dodaj linki do zdjęć</label><div id="custom-orders-input-container" class="space-y-2"><input class="calc-input gallery-input" placeholder="Link do zdjęcia" oninput="window.addGalleryInput(this)"></div><button onclick="saveCustomOrders()" class="bg-wood-600 hover:bg-wood-500 w-full py-3 rounded-xl font-bold transition mt-4">Zapisz Galerię</button></div><div id="admin-custom-orders-list" class="grid grid-cols-4 gap-4"></div></div>
             </div>
        </div>
    </div>

    <!-- LOGIKA SYSTEMU -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, addDoc, collection, deleteDoc, updateDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ==========================================
        // KONFIGURACJA FIREBASE
        // ==========================================
        let manualConfig = {
          apiKey: "AIzaSyDeRtreUSAmNWvhZm2_Fkt9OcpWs07PrVw",
          authDomain: "xeomsc-a8edd.firebaseapp.com",
          projectId: "xeomsc-a8edd",
          storageBucket: "xeomsc-a8edd.firebasestorage.app",
          messagingSenderId: "43822805612",
          appId: "1:43822805612:web:d343653e47777d8ebf5e49"
        };
        const envConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const firebaseConfig = Object.keys(manualConfig).length > 0 ? manualConfig : envConfig;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'xeomsc-fusionart';
        let db, auth, siteData = {};
        let isOnline = false;
        let lastError = "";
        let messageUnsubscribe = null; 
        
        let categoryAutoScroll = null;
        let customOrdersAutoScroll = null;
        
        window.currentLightboxImages = [];
        window.currentImgIndex = 0;
        window.selectedListCatId = null;
        window.selectedListSubId = null; 
        window.selectedListProdIndex = null;
        window.openMessageIds = new Set(); 
        window.isZoomed = false; 
        window.currentContactProductImage = null; 
        
        let confirmCallback = null;

        const STATUS_MAP = {
            'new': { label: 'Nowa', class: 'status-new' },
            'read': { label: 'Przeczytana', class: 'status-read' },
            'in-progress': { label: 'W trakcie', class: 'status-inprogress' },
            'replied': { label: 'Odp. wysłana', class: 'status-replied' },
            'closed': { label: 'Zrealizowane', class: 'status-closed' },
            'archive': { label: 'Archiwum', class: 'status-archive' }
        };

        const initialData = {
            heroItems: [{ id: 1, type: 'image', url: 'https://images.unsplash.com/photo-1622623363380-45c128919616?q=80&w=2070' }],
            categories: {},
            galleries: {},
            customOrders: [],
            imgbbKey: "",
            textContent: {
                hero: { main: "Precyzja Lasera,<br>Ciepło", accent: "Drewna", desc: "Witaj w Xeomsc FusionArt. Tworzymy spersonalizowane dekoracje, pamiątki oraz gadżety reklamowe z duszą." },
                aboutCards: [
                    { icon: "fa-solid fa-wand-magic-sparkles", title: "Grawerowanie", desc: "Niezwykle precyzyjne nanoszenie detali, logotypów i grafik na drewno, szkło, skórę i inne materiały." },
                    { icon: "fa-solid fa-scissors", title: "Precyzyjne Cięcie", desc: "Wycinanie skomplikowanych kształtów, liter przestrzennych, topperów i elementów dekoracyjnych ze sklejki." },
                    { icon: "fa-solid fa-gift", title: "Unikalne Prezenty", desc: "Personalizowane pamiątki na każdą okazję: śluby, chrzciny, jubileusze. Tworzone z myślą o Tobie." }
                ],
                contact: { email: "pkatlowski@gmail.com", phone: "+48 123 456 789", desc: "Masz pomysł na projekt? Napisz do mnie, a pomogę Ci go zrealizować i przygotuję indywidualną wycenę. Odpowiadam najszybciej jak to możliwe." },
                legal: { privacy: "", terms: "" },
                footer: { slogan: "Pasja. Precyzja. Drewno.", copyright: "&copy; 2024 Xeomsc FusionArt. Wszelkie prawa zastrzeżone." }
            },
            // DANE KALKULATORA
            calcSettings: { basePrice3mm: 0.0038, laserCostPerMin: 0.50 },
            valuations: [] 
        };

        // --- POWIADOMIENIA UI ---
        window.showToast = (msg) => {
            const toast = document.getElementById('toast-notification');
            if(toast) {
                document.getElementById('toast-text').textContent = msg;
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 3000);
            }
        };

        window.openConfirm = (text, callback) => {
            const modal = document.getElementById('confirm-modal');
            if(modal) {
                document.getElementById('confirm-text').textContent = text;
                modal.classList.remove('hidden');
                confirmCallback = callback;
            }
        };
        window.closeConfirm = (result) => {
            document.getElementById('confirm-modal').classList.add('hidden');
            if(confirmCallback && result) confirmCallback();
            confirmCallback = null;
        };

        // --- FUNKCJE KALKULATORA ---
        window.initCalculator = () => {
            const thickSelect = document.getElementById('c-thick');
            if(thickSelect) {
                thickSelect.innerHTML = '';
                for(let i=1; i<=15; i++) {
                    const opt = document.createElement('option');
                    opt.value = i;
                    opt.text = `${i} mm`;
                    if(i === 3) opt.selected = true; // Domyślnie 3mm
                    thickSelect.appendChild(opt);
                }
            }
        };

        window.renderCalculator = () => {
            if(!siteData.calcSettings) siteData.calcSettings = initialData.calcSettings;
            if(!siteData.valuations) siteData.valuations = [];

            const baseInput = document.getElementById('calc-base-price');
            const laserInput = document.getElementById('calc-laser-cost');
            if(baseInput) baseInput.value = siteData.calcSettings.basePrice3mm;
            if(laserInput) laserInput.value = siteData.calcSettings.laserCostPerMin;

            const listBody = document.getElementById('valuation-list-body');
            const emptyState = document.getElementById('valuation-empty');
            
            if(listBody) {
                listBody.innerHTML = '';

                if(siteData.valuations.length === 0) {
                    if(emptyState) emptyState.classList.remove('hidden');
                    document.getElementById('total-net').textContent = '0.00 zł';
                    document.getElementById('total-gross').textContent = '0.00 zł';
                    document.getElementById('calc-selected-count').textContent = '0';
                    return;
                }

                if(emptyState) emptyState.classList.add('hidden');

                let totalNet = 0;
                let totalGross = 0;
                let selectedCount = 0;

                siteData.valuations.forEach((item, index) => {
                    // Przeliczanie na żywo
                    const basePricePerMm = siteData.calcSettings.basePrice3mm / 3;
                    const pricePerCm2 = basePricePerMm * item.thick;
                    const areaCm2 = (item.width * item.height) / 100; // mm*mm/100 = cm2
                    const materialCost = areaCm2 * pricePerCm2;
                    const laserCost = item.time * siteData.calcSettings.laserCostPerMin;
                    const net = materialCost + laserCost;
                    const gross = net * (1 + (item.margin / 100));

                    if(item.selected) {
                        totalNet += net;
                        totalGross += gross;
                        selectedCount++;
                    }

                    const row = document.createElement('tr');
                    row.className = item.selected ? 'bg-wood-900/20' : '';
                    row.innerHTML = `
                        <td class="text-center"><input type="checkbox" onchange="toggleSelectValuation(${index})" ${item.selected ? 'checked' : ''} class="accent-wood-600 cursor-pointer"></td>
                        <td><input type="text" value="${item.name}" onchange="updateValuationItem(${index}, 'name', this.value)"></td>
                        <td><input type="number" value="${item.width}" onchange="updateValuationItem(${index}, 'width', this.value)" max="9999"></td>
                        <td><input type="number" value="${item.height}" onchange="updateValuationItem(${index}, 'height', this.value)" max="9999"></td>
                        <td>
                            <select onchange="updateValuationItem(${index}, 'thick', this.value)" class="bg-transparent text-white w-full">
                                 ${[...Array(15).keys()].map(k => `<option value="${k+1}" ${(k+1) == item.thick ? 'selected' : ''}>${k+1}mm</option>`).join('')}
                            </select>
                        </td>
                        <td class="text-right text-stone-400">${materialCost.toFixed(2)}</td>
                        <td><input type="number" value="${item.time}" onchange="updateValuationItem(${index}, 'time', this.value)"></td>
                        <td class="text-right text-stone-400">${laserCost.toFixed(2)}</td>
                        <td class="text-right font-bold text-stone-200">${net.toFixed(2)}</td>
                        <td><input type="number" value="${item.margin}" onchange="updateValuationItem(${index}, 'margin', this.value)" class="text-wood-500 font-bold" min="0" max="300"></td>
                        <td class="text-right font-bold text-wood-400 text-lg">${gross.toFixed(2)}</td>
                        <td class="text-center"><button onclick="deleteValuationItem(${index})" class="text-red-500 hover:text-red-300 transition px-2"><i class="fa-solid fa-xmark"></i></button></td>
                    `;
                    listBody.appendChild(row);
                });

                document.getElementById('total-net').textContent = totalNet.toFixed(2) + ' zł';
                document.getElementById('total-gross').textContent = totalGross.toFixed(2) + ' zł';
                document.getElementById('calc-selected-count').textContent = selectedCount;
            }
        };

        window.addValuationItem = () => {
            const name = document.getElementById('c-name').value || "Produkt bez nazwy";
            const w = parseFloat(document.getElementById('c-width').value) || 0;
            const h = parseFloat(document.getElementById('c-height').value) || 0;
            const t = parseInt(document.getElementById('c-thick').value) || 3;
            const time = parseFloat(document.getElementById('c-time').value) || 0;
            const m = parseFloat(document.getElementById('c-margin').value) || 0;

            if(w > 9999 || h > 9999) { alert("Maksymalny wymiar to 9999mm!"); return; }

            const newItem = {
                name: name,
                width: w,
                height: h,
                thick: t,
                time: time,
                margin: m,
                selected: true // Auto-zaznacz nowy
            };

            siteData.valuations.push(newItem);
            renderCalculator();
            
            document.getElementById('c-name').value = '';
            document.getElementById('c-width').value = '';
            document.getElementById('c-height').value = '';
            document.getElementById('c-time').value = '';
        };

        window.updateValuationItem = (index, field, value) => {
            if(field === 'width' || field === 'height' || field === 'time' || field === 'margin' || field === 'thick') {
                value = parseFloat(value);
            }
            siteData.valuations[index][field] = value;
            renderCalculator();
        };

        window.deleteValuationItem = (index) => {
            siteData.valuations.splice(index, 1);
            renderCalculator();
        };
        
        window.deleteSelectedValuations = () => {
             const count = siteData.valuations.filter(i => i.selected).length;
             if(count === 0) return;
             window.openConfirm(`Usunąć ${count} zaznaczonych pozycji?`, () => {
                 siteData.valuations = siteData.valuations.filter(i => !i.selected);
                 renderCalculator();
             });
        };

        window.toggleSelectValuation = (index) => {
            siteData.valuations[index].selected = !siteData.valuations[index].selected;
            renderCalculator();
        };
        
        window.toggleSelectAllCalc = (checkbox) => {
            siteData.valuations.forEach(i => i.selected = checkbox.checked);
            renderCalculator();
        };

        window.recalcAll = () => {
            const base = parseFloat(document.getElementById('calc-base-price').value);
            const laser = parseFloat(document.getElementById('calc-laser-cost').value);
            
            siteData.calcSettings.basePrice3mm = base;
            siteData.calcSettings.laserCostPerMin = laser;
            renderCalculator();
        };
        
        window.applyBulkMargin = () => {
            const margin = parseFloat(document.getElementById('bulk-margin-input').value);
            if(isNaN(margin)) return;
            
            let changed = false;
            siteData.valuations.forEach(item => {
                if(item.selected) {
                    item.margin = margin;
                    changed = true;
                }
            });
            
            if(changed) {
                renderCalculator();
                showToast(`Naliczono marżę ${margin}% dla zaznaczonych.`);
            } else {
                showToast("Zaznacz pozycje, aby zmienić marżę.");
            }
        };

        window.saveValuationsToCloud = async () => {
             await saveData();
             showToast("Wyceny zapisane w pamięci!");
        };

        // --- FUNKCJE OGÓLNE ---
        window.addHeroImage = () => {
            const url = document.getElementById('new-hero-img').value;
            if(url) {
                siteData.heroItems.push({type: 'image', url: url});
                showToast('Zdjęcie dodane!');
                saveData();
            }
        };

        window.addGalleryInput = (input) => {
            if(input.value.length > 5) {
                const container = document.getElementById('custom-orders-input-container');
                const newInput = document.createElement('input');
                newInput.className = 'calc-input gallery-input';
                newInput.placeholder = 'Kolejny link do zdjęcia';
                newInput.oninput = function() { window.addGalleryInput(this); };
                container.appendChild(newInput);
                input.oninput = null; // Remove listener from current
            }
        };

        window.saveCustomOrders = async () => {
            const inputs = document.querySelectorAll('.gallery-input');
            const urls = [];
            inputs.forEach(inp => {
                if(inp.value.length > 5) urls.push(inp.value);
            });
            siteData.customOrders = urls;
            await saveData();
            renderMain();
            showToast("Galeria zapisana!");
        };

        // --- NAWIGACJA I INTERFEJS ---
        
        window.updateNavbar = () => {
            const navbar = document.getElementById('navbar');
            if(!navbar) return;
            if (window.scrollY > 50) { navbar.classList.remove('h-24'); navbar.classList.add('h-20'); } 
            else { navbar.classList.add('h-24'); navbar.classList.remove('h-20'); }
        };
        window.addEventListener('scroll', window.updateNavbar);
        
        window.scrollCategories = (direction) => {
            const container = document.getElementById('main-categories-grid'); if(!container) return;
            const scrollAmount = window.innerWidth < 768 ? 320 : 420;
            if (direction === 1 && Math.ceil(container.scrollLeft + container.clientWidth) >= container.scrollWidth - 10) {
                container.scrollTo({ left: 0, behavior: 'smooth' }); 
            } else if (direction === -1 && container.scrollLeft <= 0) {
                container.scrollTo({ left: container.scrollWidth, behavior: 'smooth' }); 
            } else {
                container.scrollBy({ left: direction * scrollAmount, behavior: 'smooth' });
            }
        };

        window.stopAutoScroll = () => { if(categoryAutoScroll) clearInterval(categoryAutoScroll); };
        window.startAutoScroll = () => { 
            window.stopAutoScroll(); 
            categoryAutoScroll = setInterval(() => window.scrollCategories(1), 5000); 
        };

        window.scrollSubCategories = (direction) => {
            const container = document.getElementById('sub-categories-grid'); if(!container) return;
            container.scrollBy({ left: direction * 300, behavior: 'smooth' });
        };
        
        window.scrollCustomOrders = (direction) => {
            const container = document.getElementById('custom-orders-carousel'); if(!container) return;
            container.scrollBy({ left: direction * 350, behavior: 'smooth' });
        };

        function renderTexts() {
            if(!siteData.textContent || !siteData.textContent.aboutCards) { siteData.textContent = initialData.textContent; }
            if(!siteData.textContent.legal) siteData.textContent.legal = initialData.textContent.legal;
            if(!siteData.textContent.footer) siteData.textContent.footer = initialData.textContent.footer;
            const t = siteData.textContent;
            if(document.getElementById('hero-title-main')) document.getElementById('hero-title-main').innerHTML = t.hero.main;
            if(document.getElementById('hero-title-accent')) document.getElementById('hero-title-accent').textContent = t.hero.accent;
            if(document.getElementById('hero-desc')) document.getElementById('hero-desc').textContent = t.hero.desc;
            if(document.getElementById('contact-email')) document.getElementById('contact-email').textContent = t.contact.email;
            if(document.getElementById('contact-phone')) document.getElementById('contact-phone').textContent = t.contact.phone;
            if(document.getElementById('contact-desc')) document.getElementById('contact-desc').textContent = t.contact.desc;
            document.querySelectorAll('[id="footer-slogan"]').forEach(el => el.textContent = t.footer.slogan);
            document.querySelectorAll('[id="footer-copyright"]').forEach(el => el.innerHTML = t.footer.copyright);
            const grid = document.getElementById('about-grid');
            if(grid && t.aboutCards) {
                grid.innerHTML = t.aboutCards.map(c => `
                    <div class="p-10 bg-stone-50 rounded-[2.5rem] border border-stone-100 hover:shadow-2xl hover:-translate-y-2 transition-all duration-300 group">
                        <div class="w-20 h-20 bg-wood-100 text-wood-600 rounded-3xl flex items-center justify-center mx-auto mb-8 group-hover:bg-wood-600 group-hover:text-white transition-colors shadow-sm"><i class="${c.icon} text-3xl"></i></div>
                        <h3 class="font-bold text-2xl mb-4 text-stone-800">${c.title}</h3>
                        <p class="text-stone-500 leading-relaxed">${c.desc}</p>
                    </div>`).join('');
            }
        }
        
        function renderHero() {
            const container = document.getElementById('hero-carousel-container'); if (!container || !siteData.heroItems) return;
            container.innerHTML = siteData.heroItems.map((it, idx) => `<div class="hero-slide ${idx === 0 ? 'active' : ''}">${it.type === 'image' ? `<img src="${it.url}" class="w-full h-full object-cover object-center">` : `<video src="${it.url}" class="w-full h-full object-cover object-center pointer-events-none" muted autoplay loop playsinline disablepictureinpicture disableremoteplayback></video>`}</div>`).join('');
            let cur = 0; const slides = document.querySelectorAll('.hero-slide'); if(window.heroInterval) clearInterval(window.heroInterval);
            window.heroInterval = setInterval(() => { if (slides.length < 2) return; slides[cur].classList.remove('active'); cur = (cur + 1) % slides.length; slides[cur].classList.add('active'); }, 6000);
        }

        function renderMain() {
             const grid = document.getElementById('main-categories-grid'); 
             if (grid) { 
                 grid.innerHTML = ''; 
                 const cats = siteData.categories || {}; 
                 Object.entries(cats).forEach(([id, c]) => { 
                     if(!c.isHidden) {
                        grid.innerHTML += `<div id="main-cat-${id}" class="group bg-white rounded-[2.5rem] overflow-hidden shadow-sm hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 cursor-pointer border border-stone-100 fade-in min-w-[320px] md:min-w-[400px] snap-center shrink-0 category-card-item" onclick="window.selectMainCategory('${id}')"><div class="h-72 overflow-hidden relative"><img src="${c.image}" class="w-full h-full object-cover"></div><div class="p-8"><h3 class="font-bold text-2xl">${c.title}</h3></div></div>`;
                     }
                 }); 
             }
             
             // Render Custom Orders Carousel
             const coGrid = document.getElementById('custom-orders-carousel');
             if (coGrid) {
                 coGrid.innerHTML = '';
                 (siteData.customOrders || []).forEach(img => {
                    coGrid.innerHTML += `<div class="min-w-[300px] h-[300px] rounded-3xl overflow-hidden shadow-lg cursor-pointer custom-order-item snap-center shrink-0" onclick="window.openCustomOrdersGallery()"><img src="${img}" class="w-full h-full object-cover transition-transform duration-500"></div>`;
                 });
             }
        }

        window.selectMainCategory = (id) => {
            // Remove selection style from others
            document.querySelectorAll('.category-card-item').forEach(el => el.classList.remove('selected-category-border', 'border-wood-600', 'ring-4', 'ring-wood-200'));
            
            const card = document.getElementById(`main-cat-${id}`);
            if(card) card.classList.add('selected-category-border', 'border-wood-600', 'ring-4', 'ring-wood-200');

            const cat = siteData.categories[id];
            if(!cat) return;

            document.getElementById('sub-categories-container').classList.remove('hidden');
            document.getElementById('selected-cat-title').textContent = cat.title;
            document.getElementById('btn-see-all-subcats').onclick = () => window.openSubcategoriesFullView(id);

            const grid = document.getElementById('sub-categories-grid');
            grid.innerHTML = '';
            
            // Get subcategories for this category
            const subcats = Object.entries(siteData.subcategories || {}).filter(([_, s]) => s.parentId === id);
            
            if(subcats.length === 0) {
                grid.innerHTML = '<p class="text-stone-400 p-4">Brak podkategorii.</p>';
                return;
            }

            subcats.forEach(([sid, s]) => {
                grid.innerHTML += `
                    <div onclick="window.openSubcategoryView('${sid}')" class="min-w-[280px] bg-white border border-stone-100 rounded-3xl p-4 cursor-pointer hover:shadow-xl hover:-translate-y-1 transition-all duration-300 snap-center shrink-0 group">
                        <div class="aspect-square rounded-2xl overflow-hidden mb-4 bg-stone-50"><img src="${s.image}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500"></div>
                        <h4 class="font-bold text-lg text-center text-stone-800">${s.title}</h4>
                    </div>
                `;
            });
            
            // Auto scroll to subcats
            document.getElementById('sub-categories-container').scrollIntoView({ behavior: 'smooth', block: 'start' });
        };
        
        window.openSubcategoryView = (subId) => {
             const sub = siteData.subcategories[subId];
             if(!sub) return;
             
             window.selectedListSubId = subId;
             document.getElementById('main-content').classList.add('hidden');
             const view = document.getElementById('subcategory-view');
             view.classList.remove('hidden');
             document.getElementById('subcategory-title').textContent = sub.title;
             
             const grid = document.getElementById('subcategory-grid');
             grid.innerHTML = '';
             
             const prods = (siteData.products || []).filter(p => p.subcategoryId === subId);
             
             prods.forEach((p, idx) => {
                 // Find global index
                 const globalIdx = (siteData.products || []).indexOf(p);
                 grid.innerHTML += `
                    <div onclick="window.openGallery(${globalIdx})" class="group cursor-pointer">
                        <div class="aspect-square bg-stone-100 rounded-3xl overflow-hidden mb-6 relative"><img src="${p.images[0]}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500"></div>
                        <h3 class="text-xl font-bold mb-2 group-hover:text-wood-600 transition">${p.title}</h3>
                        <p class="text-stone-500 text-sm line-clamp-2">${p.desc}</p>
                        <span class="inline-block mt-4 text-wood-600 font-bold">${p.price}</span>
                    </div>
                 `;
             });
        };
        
        window.openGallery = (prodIndex) => {
            const p = siteData.products[prodIndex];
            if(!p) return;
            window.selectedListProdIndex = prodIndex;
            
            document.getElementById('subcategory-view').classList.add('hidden');
            const view = document.getElementById('gallery-view');
            view.classList.remove('hidden');
            
            document.getElementById('prod-title').textContent = p.title;
            document.getElementById('prod-desc').textContent = p.desc;
            document.getElementById('prod-price').textContent = p.price;
            document.getElementById('prod-code').textContent = `Kod: ${p.code || '---'}`;
            
            window.currentLightboxImages = p.images;
            window.currentImgIndex = 0;
            
            const mainImg = document.getElementById('main-product-img');
            mainImg.src = p.images[0];
            
            const thumbs = document.getElementById('product-thumbnails');
            thumbs.innerHTML = '';
            p.images.forEach((img, i) => {
                thumbs.innerHTML += `<img src="${img}" onclick="window.changeGalleryImage(${i})" class="w-20 h-20 rounded-xl object-cover cursor-pointer border-2 ${i===0 ? 'border-wood-600' : 'border-transparent'} hover:border-wood-400 transition snap-start shrink-0">`;
            });
            
            document.getElementById('ask-btn').onclick = () => window.openProductContact(p.code, p.title);
            document.getElementById('back-to-sub-btn').onclick = () => {
                document.getElementById('gallery-view').classList.add('hidden');
                document.getElementById('subcategory-view').classList.remove('hidden');
            };
        };
        
        window.changeGalleryImage = (index) => {
            window.currentImgIndex = index;
            const mainImg = document.getElementById('main-product-img');
            mainImg.style.opacity = '0';
            setTimeout(() => {
                mainImg.src = window.currentLightboxImages[index];
                mainImg.style.opacity = '1';
            }, 200);
            
            // Update thumbs active state
            const thumbs = document.getElementById('product-thumbnails').children;
            for(let i=0; i<thumbs.length; i++) {
                if(i === index) thumbs[i].classList.add('border-wood-600');
                else thumbs[i].classList.remove('border-wood-600');
            }
        };

        window.goBackToSubcategoryList = () => {
            document.getElementById('subcategory-view').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
        };

        window.goHome = () => { 
            document.getElementById('subcategory-view').classList.add('hidden'); document.getElementById('subcategories-full-view').classList.add('hidden'); document.getElementById('gallery-view').classList.add('hidden'); document.getElementById('custom-orders-full-view').classList.add('hidden'); document.getElementById('legal-view').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden'); document.getElementById('sub-categories-container').classList.add('hidden'); 
            document.querySelectorAll('.category-card-item').forEach(el => el.classList.remove('selected-category-border', 'border-wood-600', 'ring-4', 'ring-wood-200'));
            window.scrollTo(0,0);
        };
        
        window.handleLogin = () => {
            const u = document.getElementById('login-user').value; const p = document.getElementById('login-pass').value;
            if(u === 'AdminXeons1308' && p === 'Ktymnyy5') { sessionStorage.setItem('xeomsc_admin', 'true'); location.reload(); } 
            else { document.getElementById('login-error').classList.remove('hidden'); }
        };
        window.handleLogout = () => { sessionStorage.removeItem('xeomsc_admin'); if(messageUnsubscribe) messageUnsubscribe(); location.reload(); };
        window.toggleAdminPanel = () => { const p = document.getElementById('admin-panel'); p.classList.toggle('hidden'); if(!p.classList.contains('hidden')) window.switchAdminView('messages'); };
        window.exitLogin = () => { document.getElementById('login-screen').classList.add('hidden'); window.location.hash = ''; };

        // --- FUNKCJE ADMINA ---
        window.switchAdminView = (id) => {
            document.querySelectorAll('.admin-view').forEach(v => v.classList.add('hidden'));
            document.querySelectorAll('.admin-sidebar-item').forEach(b => b.classList.remove('active'));
            
            const view = document.getElementById(`view-${id}`); if (view) view.classList.remove('hidden');
            const btn = document.getElementById(`btn-${id}`); if (btn) btn.classList.add('active');
            
            if (id === 'calculator') { window.renderCalculator(); }
            else if (id === 'content') {
                 const t = siteData.textContent;
                 document.getElementById('edit-hero-main').value = t.hero.main;
                 document.getElementById('edit-hero-accent').value = t.hero.accent;
                 document.getElementById('edit-hero-desc').value = t.hero.desc;
                 document.getElementById('edit-contact-email').value = t.contact.email;
                 document.getElementById('edit-contact-phone').value = t.contact.phone;
                 document.getElementById('edit-contact-desc').value = t.contact.desc;
                 document.getElementById('edit-privacy').value = t.legal.privacy;
                 document.getElementById('edit-terms').value = t.legal.terms;
                 document.getElementById('edit-footer-slogan').value = t.footer.slogan;
                 document.getElementById('edit-footer-copyright').value = t.footer.copyright;
                 document.getElementById('edit-imgbb-key').value = siteData.imgbbKey || "";
            }
        };
        
        window.saveContentSettings = async () => {
            siteData.textContent.hero.main = document.getElementById('edit-hero-main').value;
            siteData.textContent.hero.accent = document.getElementById('edit-hero-accent').value;
            siteData.textContent.hero.desc = document.getElementById('edit-hero-desc').value;
            siteData.textContent.contact.email = document.getElementById('edit-contact-email').value;
            siteData.textContent.contact.phone = document.getElementById('edit-contact-phone').value;
            siteData.textContent.contact.desc = document.getElementById('edit-contact-desc').value;
            siteData.textContent.legal.privacy = document.getElementById('edit-privacy').value;
            siteData.textContent.legal.terms = document.getElementById('edit-terms').value;
            siteData.textContent.footer.slogan = document.getElementById('edit-footer-slogan').value;
            siteData.textContent.footer.copyright = document.getElementById('edit-footer-copyright').value;
            siteData.imgbbKey = document.getElementById('edit-imgbb-key').value;
            
            await saveData();
            renderTexts();
            showToast("Zapisano treści!");
        };

        // Lightbox Logic
        window.openLightbox = (index) => {
            window.currentImgIndex = index;
            document.getElementById('lightbox-img').src = window.currentLightboxImages[index];
            document.getElementById('lightbox').classList.remove('hidden');
            setTimeout(() => document.getElementById('lightbox').classList.remove('opacity-0'), 10);
            document.getElementById('lightbox-counter').innerText = `${index + 1} / ${window.currentLightboxImages.length}`;
        };
        
        window.closeLightbox = () => {
            document.getElementById('lightbox').classList.add('opacity-0');
            setTimeout(() => document.getElementById('lightbox').classList.add('hidden'), 300);
            window.isZoomed = false;
            document.getElementById('lightbox-img').style.transform = "scale(1)";
        };
        
        window.changeLightboxImage = (dir) => {
            let newIndex = window.currentImgIndex + dir;
            if (newIndex < 0) newIndex = window.currentLightboxImages.length - 1;
            if (newIndex >= window.currentLightboxImages.length) newIndex = 0;
            window.currentImgIndex = newIndex;
            
            const img = document.getElementById('lightbox-img');
            img.style.opacity = '0';
            setTimeout(() => {
                img.src = window.currentLightboxImages[newIndex];
                img.style.opacity = '1';
                document.getElementById('lightbox-counter').innerText = `${newIndex + 1} / ${window.currentLightboxImages.length}`;
            }, 200);
        };
        
        window.openProductContact = (code, title) => {
            document.getElementById('contact-modal').classList.remove('hidden');
            document.getElementById('contact-message').value = `Dzień dobry, jestem zainteresowany produktem: ${title} (Kod: ${code}). Proszę o więcej informacji.`;
        };
        
        window.closeContactModal = () => document.getElementById('contact-modal').classList.add('hidden');
        
        window.submitContactForm = () => {
             // Mock submission
             showToast("Wiadomość wysłana! (Symulacja)");
             window.closeContactModal();
        };

        window.openGeneralContactModal = () => {
            document.getElementById('contact-modal').classList.remove('hidden');
            document.getElementById('contact-message').value = "";
        };
        
        window.openLegal = (type) => {
            const content = type === 'privacy' ? siteData.textContent.legal.privacy : siteData.textContent.legal.terms;
            const title = type === 'privacy' ? "Polityka Prywatności" : "Regulamin";
            document.getElementById('main-content').classList.add('hidden');
            document.getElementById('legal-view').classList.remove('hidden');
            document.getElementById('legal-title').innerText = title;
            document.getElementById('legal-content').innerText = content || "Treść w przygotowaniu...";
        };
        
        window.closeLegal = () => {
            document.getElementById('legal-view').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
        };

        window.openCustomOrdersGallery = () => {
             window.currentLightboxImages = siteData.customOrders || [];
             if(window.currentLightboxImages.length > 0) window.openLightbox(0);
             else showToast("Brak zdjęć w galerii zleceń.");
        };

        window.toggleMobileMenu = () => {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        };

        async function saveData() {
            try {
                localStorage.setItem('xeomsc_cached_data', JSON.stringify(siteData));
                if(isOnline && auth && auth.currentUser) {
                    await setDoc(doc(db, `artifacts/${appId}/public/data/siteConfig`, 'main'), siteData);
                    console.log("Zapisano w chmurze");
                }
            } catch(e) { console.error("Błąd zapisu", e); showToast("Błąd zapisu!"); }
        }

        async function start() {
            window.initCalculator(); 

            if(sessionStorage.getItem('xeomsc_admin') === 'true') { 
                document.body.classList.add('is-admin'); document.getElementById('admin-bar').classList.remove('hidden'); 
            } else if(window.location.hash === '#admin') { document.getElementById('login-screen').classList.remove('hidden'); }

            try {
                if (Object.keys(firebaseConfig).length > 0) {
                    const appObj = initializeApp(firebaseConfig); auth = getAuth(appObj); db = getFirestore(appObj);
                    try { if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) { await signInWithCustomToken(auth, __initial_auth_token); } else { await signInAnonymously(auth); } } catch (authError) { return; }

                    onAuthStateChanged(auth, (u) => {
                        if(u) {
                            isOnline = true;
                            document.getElementById('status-dot').className = 'status-dot status-online';
                            document.getElementById('status-text').textContent = 'Online';
                            onSnapshot(doc(db, `artifacts/${appId}/public/data/siteConfig`, 'main'), (snap) => {
                                if (snap.exists()) {
                                    siteData = snap.data();
                                    if(!siteData.calcSettings) siteData.calcSettings = initialData.calcSettings;
                                    if(!siteData.valuations) siteData.valuations = [];
                                    localStorage.setItem('xeomsc_cached_data', JSON.stringify(siteData));
                                    renderHero(); renderMain(); renderTexts();
                                    if(!document.getElementById('view-calculator').classList.contains('hidden')) renderCalculator();
                                } 
                            });
                        }
                    });
                }
            } catch (e) { console.log("Tryb offline", e); }
        }

        siteData = JSON.parse(localStorage.getItem('xeomsc_cached_data')) || initialData;
        renderHero(); renderMain(); renderTexts(); start();
        window.startAutoScroll();
    </script>
</body>
</html>