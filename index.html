<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xeomsc WoodArt - Grawerowanie Laserowe i Drewno</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        wood: {
                            100: '#fef3c7',
                            500: '#d97706',
                            600: '#b45309',
                            800: '#92400e',
                            900: '#78350f',
                        },
                        stone: {
                            50: '#fafaf9',
                            800: '#292524',
                            900: '#1c1917',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            scroll-behavior: smooth;
        }
        
        .gradient-text {
            background: linear-gradient(to right, #b45309, #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .text-outline {
            text-shadow: 0px 2px 10px rgba(0,0,0,0.6);
        }

        .hero-bg {
            background-color: #fafaf9;
            background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23d6d3d1' fill-opacity='0.2' fill-rule='evenodd'%3E%3Ccircle cx='3' cy='3' r='3'/%3E%3Ccircle cx='13' cy='13' r='3'/%3E%3C/g%3E%3C/svg%3E");
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .hero-slide {
            position: absolute;
            inset: 0;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        .hero-slide.active {
            opacity: 1;
            z-index: 10;
        }
        
        .admin-sidebar-item.active {
            background-color: #b45309;
            color: white;
        }

        .calc-input {
            background: #1c1917;
            border: 1px solid #444;
            color: white;
            padding: 0.5rem;
            border-radius: 0.5rem;
            width: 100%;
            outline: none;
        }

        .admin-controls {
            display: none !important;
        }
        body.is-admin .admin-controls {
            display: flex !important;
        }
    </style>
</head>
<body class="text-stone-800 bg-stone-50">

    <!-- PANEL LOGOWANIA -->
    <div id="login-screen" class="fixed inset-0 z-[300] bg-stone-900 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-8 text-center">
            <i class="fa-solid fa-user-lock text-wood-600 text-4xl mb-4"></i>
            <h2 class="text-2xl font-bold mb-6">Panel Administratora</h2>
            <form id="admin-login-form" class="space-y-4 text-left">
                <input type="text" id="login-user" class="w-full border p-3 rounded-lg" placeholder="Login">
                <input type="password" id="login-pass" class="w-full border p-3 rounded-lg" placeholder="Hasło">
                <div id="login-error" class="text-red-500 text-sm hidden font-bold">Błędny login lub hasło!</div>
                <button type="submit" class="w-full bg-wood-600 text-white py-3 rounded-lg font-bold">Zaloguj się</button>
            </form>
            <button id="exit-login-btn" class="mt-4 text-gray-400 underline text-sm">Powrót</button>
        </div>
    </div>

    <!-- PASEK ADMINA -->
    <div id="admin-bar" class="hidden bg-stone-900 text-white py-2 px-4 fixed top-0 w-full z-[150] flex justify-between items-center">
        <span class="text-xs font-bold text-green-400"><i class="fa-solid fa-cloud mr-2"></i> Tryb Admina</span>
        <div class="flex gap-4">
            <button id="toggle-admin-panel-btn" class="bg-wood-600 px-3 py-1 rounded text-xs font-bold">Panel Sterowania</button>
            <button id="logout-btn" class="text-xs hover:text-red-400">Wyloguj</button>
        </div>
    </div>

    <!-- NAWIGACJA -->
    <nav class="fixed w-full z-50 bg-white/90 backdrop-blur-md shadow-sm top-0 h-20 flex items-center">
        <div class="max-w-7xl mx-auto px-4 w-full flex justify-between items-center">
            <a href="#" id="logo-link" class="text-2xl font-bold text-wood-600 flex items-center">
                <i class="fa-solid fa-bolt mr-2"></i> Xeomsc WoodArt
            </a>
            <div class="hidden md:flex gap-8 items-center font-medium">
                <a href="#home" class="hover:text-wood-600">Start</a>
                <a href="#about" class="hover:text-wood-600">O ofercie</a>
                <a href="#portfolio" class="hover:text-wood-600">Realizacje</a>
                <a href="#contact" class="bg-wood-600 text-white px-5 py-2 rounded-lg shadow-md">Wycena</a>
            </div>
        </div>
    </nav>

    <!-- TREŚĆ GŁÓWNA -->
    <div id="main-content" class="pt-0">
        <!-- Hero -->
        <section id="home" class="relative h-screen flex items-center hero-bg overflow-hidden">
            <div class="absolute inset-0 z-0" id="hero-carousel-container"></div>
            <div class="absolute inset-0 bg-black/20 z-10 pointer-events-none"></div>
            <div class="max-w-7xl mx-auto px-4 relative z-20 w-full">
                <div class="max-w-xl text-center md:text-left">
                    <h1 class="text-4xl md:text-6xl font-bold text-white text-outline leading-tight mb-6">
                        Precyzja Lasera,<br>Ciepło <span class="gradient-text">Drewna</span>.
                    </h1>
                    <p class="text-lg text-white text-outline mb-8">Tworzymy unikalne projekty dopasowane do Twoich potrzeb.</p>
                    <div class="flex gap-4 justify-center md:justify-start">
                        <a href="#portfolio" class="bg-wood-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg">Portfolio</a>
                        <a href="#contact" class="bg-white/90 text-wood-600 px-8 py-3 rounded-xl font-bold">Kontakt</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Realizacje -->
        <section id="portfolio" class="py-24 bg-stone-50">
            <div class="max-w-7xl mx-auto px-4 text-center">
                <h2 class="text-4xl font-bold mb-12">Moje Realizacje</h2>
                <div id="main-categories-grid" class="grid grid-cols-1 md:grid-cols-3 gap-8 text-left"></div>
            </div>
        </section>

        <!-- Kontakt -->
        <section id="contact" class="py-24 bg-white border-t">
            <div class="max-w-4xl mx-auto px-4 text-center">
                <h2 class="text-4xl font-bold mb-12">Kontakt</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="p-8 bg-stone-50 rounded-2xl"><i class="fa-solid fa-envelope text-3xl mb-4 text-wood-600"></i><p class="font-bold">pkatlowski@gmail.com</p></div>
                    <div class="p-8 bg-stone-50 rounded-2xl"><i class="fa-solid fa-phone text-3xl mb-4 text-wood-600"></i><p class="font-bold">+48 123 456 789</p></div>
                </div>
            </div>
        </section>
    </div>

    <!-- WIDOKI DYNAMICZNE -->
    <div id="subcategory-view" class="hidden min-h-screen pt-32 pb-20 fade-in">
        <div class="max-w-7xl mx-auto px-4">
            <button id="back-to-main-btn" class="mb-8 font-bold text-wood-600"><i class="fa-solid fa-arrow-left mr-2"></i> Powrót</button>
            <h2 id="subcategory-title" class="text-4xl font-bold mb-8"></h2>
            <div id="subcategory-grid" class="grid grid-cols-1 md:grid-cols-3 gap-8"></div>
        </div>
    </div>

    <div id="gallery-view" class="hidden min-h-screen pt-32 pb-20 fade-in">
        <div class="max-w-7xl mx-auto px-4">
            <button id="back-to-sub-btn" class="mb-8 font-bold text-wood-600"><i class="fa-solid fa-arrow-left mr-2"></i> Powrót</button>
            <h2 id="gallery-title" class="text-4xl font-bold mb-8">Galeria</h2>
            <div id="gallery-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
        </div>
    </div>

    <!-- LIGHTBOX -->
    <div id="lightbox" class="fixed inset-0 z-[1000] bg-black/95 hidden items-center justify-center p-4">
        <img id="lightbox-img" src="" class="max-h-full max-w-full rounded-lg shadow-2xl">
        <button id="close-lightbox-btn" class="absolute top-4 right-4 text-white text-4xl"><i class="fa-solid fa-xmark"></i></button>
    </div>

    <!-- PANEL ADMINA (MODAL) -->
    <div id="admin-panel" class="fixed inset-0 z-[2000] bg-black/60 backdrop-blur-sm hidden items-center justify-center p-4">
        <div class="bg-stone-900 text-white w-full max-w-5xl h-[80vh] rounded-3xl overflow-hidden flex flex-col md:flex-row shadow-2xl">
            <div class="w-full md:w-64 bg-stone-950 p-6 flex flex-col border-r border-white/5">
                <h3 class="text-xl font-bold mb-8 text-wood-500">Zarządzanie</h3>
                <nav class="space-y-2 flex-1">
                    <button id="btn-hero-gallery" class="admin-sidebar-item w-full text-left px-4 py-2 rounded-lg">Karuzela</button>
                    <button id="btn-categories" class="admin-sidebar-item w-full text-left px-4 py-2 rounded-lg">Kategorie</button>
                    <button id="btn-products" class="admin-sidebar-item w-full text-left px-4 py-2 rounded-lg">Produkty</button>
                    <button id="btn-calculator" class="admin-sidebar-item w-full text-left px-4 py-2 rounded-lg">Kalkulator</button>
                </nav>
                <button id="close-admin-panel-btn" class="mt-4 text-sm text-stone-500 underline">Zamknij</button>
            </div>
            <div class="flex-1 p-8 overflow-y-auto" id="admin-view-container"></div>
        </div>
    </div>

    <footer class="bg-stone-950 text-stone-500 py-12 text-center text-sm border-t border-white/5">
        <p>&copy; 2024 Xeomsc WoodArt. <button id="admin-footer-btn" class="hidden hover:text-white underline ml-2">Admin</button></p>
    </footer>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = JSON.parse(__firebase_config || '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'xeomsc-woodart';
        
        let db, auth, siteData = {};

        const initialData = {
            heroItems: [{ id: 1, type: 'image', url: 'https://images.unsplash.com/photo-1542332213-31f87348057f?q=80&w=2070' }],
            categories: {},
            galleries: {},
            calcSettings: { rateLaserMin: 0.50, rateCm2: 0.0038, overhead: 10, margin: 20 }
        };

        // --- FUNKCJE RENDERUJĄCE ---
        function renderHero() {
            const container = document.getElementById('hero-carousel-container');
            if (!container || !siteData.heroItems) return;
            container.innerHTML = siteData.heroItems.map((it, idx) => `
                <div class="hero-slide ${idx === 0 ? 'active' : ''}">
                    ${it.type === 'image' ? `<img src="${it.url}" class="w-full h-full object-cover">` : `<video src="${it.url}" class="w-full h-full object-cover" muted autoplay loop></video>`}
                </div>
            `).join('');
            
            let cur = 0;
            setInterval(() => {
                const slides = document.querySelectorAll('.hero-slide');
                if (slides.length < 2) return;
                slides[cur].classList.remove('active');
                cur = (cur + 1) % slides.length;
                slides[cur].classList.add('active');
            }, 5000);
        }

        function renderMain() {
            const grid = document.getElementById('main-categories-grid');
            if (!grid) return;
            grid.innerHTML = Object.entries(siteData.categories).map(([id, c]) => `
                <div class="bg-white rounded-3xl overflow-hidden shadow-sm hover:shadow-xl transition cursor-pointer border border-stone-100 fade-in" onclick="window.openSub('${id}')">
                    <img src="${c.image || 'https://via.placeholder.com/400'}" class="h-64 w-full object-cover">
                    <div class="p-6">
                        <h3 class="font-bold text-xl">${c.title}</h3>
                        <p class="text-stone-500 text-sm">${c.desc || ''}</p>
                    </div>
                </div>
            `).join('');
        }

        window.openSub = (id) => {
            const c = siteData.categories[id];
            document.getElementById('subcategory-title').textContent = c.title;
            document.getElementById('subcategory-grid').innerHTML = c.subcategories.map((s, i) => `
                <div class="bg-white rounded-2xl overflow-hidden border border-stone-100 cursor-pointer hover:shadow-lg transition relative" onclick="window.openGal('${s.id}', '${s.title}', '${id}')">
                    <img src="${s.image}" class="h-48 w-full object-cover">
                    <div class="p-4 flex justify-between items-center">
                        <span class="font-bold">${s.title}</span>
                        <button onclick="event.stopPropagation(); window.delSub('${id}',${i})" class="admin-controls text-red-500"><i class="fa-solid fa-trash"></i></button>
                    </div>
                </div>
            `).join('');
            document.getElementById('main-content').classList.add('hidden');
            document.getElementById('subcategory-view').classList.remove('hidden');
            window.scrollTo(0,0);
        };

        window.openGal = (sid, title, cid) => {
            const g = siteData.galleries[sid] || { images: [] };
            document.getElementById('gallery-title').textContent = title;
            document.getElementById('back-to-sub-btn').onclick = () => window.openSub(cid);
            document.getElementById('gallery-grid').innerHTML = g.images.map((img, i) => `
                <div class="relative aspect-square rounded-xl overflow-hidden cursor-pointer shadow-md group">
                    <img src="${img.src}" class="w-full h-full object-cover" onclick="window.openLightbox('${img.src}')">
                    <button onclick="window.delImg('${sid}',${i},'${cid}','${title}')" class="admin-controls absolute top-2 right-2 bg-red-500 text-white p-2 rounded-lg"><i class="fa-solid fa-trash"></i></button>
                </div>
            `).join('');
            document.getElementById('subcategory-view').classList.add('hidden');
            document.getElementById('gallery-view').classList.remove('hidden');
            window.scrollTo(0,0);
        };

        // --- ADMIN ---
        async function saveData() {
            localStorage.setItem('xeomsc_cached_data', JSON.stringify(siteData));
            if (auth.currentUser) {
                await setDoc(doc(db, `artifacts/${appId}/public/data/siteConfig`, 'main'), siteData);
            }
        }

        function switchView(view) {
            const cont = document.getElementById('admin-view-container');
            document.querySelectorAll('.admin-sidebar-item').forEach(b => b.classList.toggle('active', b.id === `btn-${view}`));
            
            if (view === 'hero-gallery') {
                cont.innerHTML = `
                    <h4 class="text-xl font-bold mb-4 text-wood-500">Karuzela</h4>
                    <div class="space-y-4 mb-8">
                        <input id="h-url" class="calc-input" placeholder="URL Zdjęcia/Wideo">
                        <select id="h-type" class="calc-input"><option value="image">Zdjęcie</option><option value="video">Wideo</option></select>
                        <button id="add-h-btn" class="bg-wood-600 w-full p-3 rounded-lg font-bold">Dodaj</button>
                    </div>
                    <div class="space-y-2">${siteData.heroItems.map((h, i) => `<div class="bg-black/40 p-3 rounded flex justify-between"><span>${h.url}</span><button onclick="window.delHero(${i})" class="text-red-500">Usuń</button></div>`).join('')}</div>
                `;
                document.getElementById('add-h-btn').onclick = () => {
                    const url = document.getElementById('h-url').value;
                    if(url) { siteData.heroItems.push({type: document.getElementById('h-type').value, url}); saveData(); switchView('hero-gallery'); }
                };
            } else if (view === 'calculator') {
                cont.innerHTML = `
                    <h4 class="text-xl font-bold mb-4 text-wood-500">Kalkulator</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <input id="cw" class="calc-input" value="100" type="number" placeholder="Szerokość mm">
                        <input id="ch" class="calc-input" value="100" type="number" placeholder="Wysokość mm">
                    </div>
                    <input id="ct" class="calc-input mt-4" value="10" type="number" placeholder="Czas min">
                    <div class="mt-8 p-6 bg-black/40 rounded-2xl text-center">
                        <p class="text-xs text-stone-500 uppercase">Cena sugerowana</p>
                        <div id="c-res" class="text-5xl font-bold text-wood-500 mt-2">0.00 PLN</div>
                    </div>
                `;
                ['cw', 'ch', 'ct'].forEach(id => document.getElementById(id).oninput = () => {
                    const w = parseFloat(document.getElementById('cw').value) || 0;
                    const h = parseFloat(document.getElementById('ch').value) || 0;
                    const t = parseFloat(document.getElementById('ct').value) || 0;
                    const res = ((w * h / 100) * siteData.calcSettings.rateCm2 + t * siteData.calcSettings.rateLaserMin) * 1.32;
                    document.getElementById('c-res').textContent = res.toFixed(2) + " PLN";
                });
            } else if (view === 'categories') {
                cont.innerHTML = `
                    <h4 class="text-xl font-bold mb-4 text-wood-500">Kategorie</h4>
                    <div class="space-y-4 mb-8">
                        <input id="cat-t" class="calc-input" placeholder="Nazwa">
                        <input id="cat-i" class="calc-input" placeholder="Okładka">
                        <button id="add-cat-btn" class="bg-wood-600 w-full p-3 rounded-lg font-bold">Dodaj</button>
                    </div>
                    <div class="space-y-2">${Object.keys(siteData.categories).map(k => `<div class="bg-black/40 p-3 rounded flex justify-between"><span>${siteData.categories[k].title}</span><button onclick="window.delCat('${k}')" class="text-red-500">Usuń</button></div>`).join('')}</div>
                `;
                document.getElementById('add-cat-btn').onclick = () => {
                    const t = document.getElementById('cat-t').value;
                    if(t) {
                        const id = 'c' + Date.now();
                        siteData.categories[id] = { title: t, image: document.getElementById('cat-i').value, subcategories: [] };
                        saveData(); switchView('categories');
                    }
                };
            } else if (view === 'products') {
                cont.innerHTML = `
                    <h4 class="text-xl font-bold mb-4 text-wood-500">Dodaj Produkt</h4>
                    <select id="p-cat" class="calc-input mb-2">${Object.keys(siteData.categories).map(k => `<option value="${k}">${siteData.categories[k].title}</option>`).join('')}</select>
                    <input id="p-t" class="calc-input mb-2" placeholder="Nazwa produktu">
                    <input id="p-i" class="calc-input mb-4" placeholder="Okładka">
                    <button id="p-btn" class="bg-wood-600 w-full p-3 rounded-lg font-bold">Zapisz Produkt</button>
                `;
                document.getElementById('p-btn').onclick = () => {
                    const cid = document.getElementById('p-cat').value;
                    const t = document.getElementById('p-t').value;
                    if(cid && t) {
                        const sid = 's' + Date.now();
                        siteData.categories[cid].subcategories.push({ id: sid, title: t, image: document.getElementById('p-i').value });
                        siteData.galleries[sid] = { images: [] };
                        saveData(); alert("Dodano!");
                    }
                };
            }
        }

        window.delHero = (i) => { siteData.heroItems.splice(i,1); saveData(); switchView('hero-gallery'); renderHero(); };
        window.delCat = (k) => { if(confirm("Usuń kategorię?")) { delete siteData.categories[k]; saveData(); switchView('categories'); renderMain(); }};
        window.delSub = (cid, i) => { siteData.categories[cid].subcategories.splice(i,1); saveData(); window.openSub(cid); };
        window.delImg = (sid, i, cid, t) => { siteData.galleries[sid].images.splice(i,1); saveData(); window.openGal(sid, t, cid); };

        window.openLightbox = (src) => {
            document.getElementById('lightbox-img').src = src;
            document.getElementById('lightbox').classList.replace('hidden','flex');
        };
        document.getElementById('close-lightbox-btn').onclick = () => document.getElementById('lightbox').classList.replace('flex','hidden');

        // --- INICJALIZACJA ---
        async function start() {
            try {
                const appObj = initializeApp(firebaseConfig);
                auth = getAuth(appObj);
                db = getFirestore(appObj);
                
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (u) => {
                    if (u) {
                        const docRef = doc(db, `artifacts/${appId}/public/data/siteConfig`, 'main');
                        onSnapshot(docRef, (snap) => {
                            if (snap.exists()) {
                                siteData = snap.data();
                                localStorage.setItem('xeomsc_cached_data', JSON.stringify(siteData));
                                renderHero();
                                renderMain();
                            }
                        });
                        if (sessionStorage.getItem('xeomsc_admin') === 'true') {
                            document.body.classList.add('is-admin');
                            document.getElementById('admin-bar').classList.remove('hidden');
                            document.getElementById('admin-footer-btn').classList.remove('hidden');
                        }
                    }
                });
            } catch (e) {
                console.error("Firebase init failed, using cache:", e);
                renderHero();
                renderMain();
            }
        }

        // GUI Eventy
        document.getElementById('logo-link').onclick = (e) => { e.preventDefault(); document.querySelectorAll('#subcategory-view, #gallery-view').forEach(v => v.classList.add('hidden')); document.getElementById('main-content').classList.remove('hidden'); };
        document.getElementById('back-to-main-btn').onclick = () => document.getElementById('logo-link').click();
        document.getElementById('admin-footer-btn').onclick = () => document.getElementById('admin-panel').classList.remove('hidden');
        document.getElementById('toggle-admin-panel-btn').onclick = () => { document.getElementById('admin-panel').classList.remove('hidden'); switchView('hero-gallery'); };
        document.getElementById('close-admin-panel-btn').onclick = () => document.getElementById('admin-panel').classList.add('hidden');
        document.getElementById('admin-login-form').onsubmit = (e) => {
            e.preventDefault();
            if(document.getElementById('login-user').value === 'admin' && document.getElementById('login-pass').value === '12345') {
                sessionStorage.setItem('xeomsc_admin', 'true'); location.reload();
            } else document.getElementById('login-error').classList.remove('hidden');
        };
        document.getElementById('logout-btn').onclick = () => { sessionStorage.removeItem('xeomsc_admin'); location.reload(); };

        ['hero-gallery', 'categories', 'products', 'calculator'].forEach(id => {
            const btn = document.getElementById(`btn-${id}`);
            if(btn) btn.onclick = () => switchView(id);
        });

        // Uruchomienie
        siteData = JSON.parse(localStorage.getItem('xeomsc_cached_data')) || initialData;
        renderHero();
        renderMain();
        start();
        
        if (window.location.hash === '#admin') document.getElementById('login-screen').classList.remove('hidden');
        document.getElementById('exit-login-btn').onclick = () => { window.location.hash = ''; location.reload(); };
    </script>
</body>
</html>