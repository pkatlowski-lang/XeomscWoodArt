<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xeomsc LaserHeat Art - Grawerowanie Laserowe i Drewno</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        wood: { 100: '#fef3c7', 500: '#d97706', 600: '#b45309', 800: '#92400e', 900: '#78350f' },
                        stone: { 50: '#fafaf9', 800: '#292524', 900: '#1c1917' }
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Poppins', sans-serif; scroll-behavior: smooth; }
        .gradient-text { background: linear-gradient(to right, #b45309, #d97706); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .text-outline { text-shadow: 0px 2px 10px rgba(0,0,0,0.6); }
        .hero-bg { background-color: #fafaf9; background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23d6d3d1' fill-opacity='0.2' fill-rule='evenodd'%3E%3Ccircle cx='3' cy='3' r='3'/%3E%3Ccircle cx='13' cy='13' r='3'/%3E%3C/g%3E%3C/svg%3E"); }
        .hero-slide { position: absolute; inset: 0; opacity: 0; transition: opacity 1s ease-in-out; }
        .hero-slide.active { opacity: 1; z-index: 10; }
        .admin-sidebar-item.active { background-color: #b45309; color: white; }
        .calc-input { background: #1c1917; border: 1px solid #444; color: white; padding: 0.6rem; border-radius: 0.5rem; width: 100%; outline: none; }
        .admin-controls { display: none !important; }
        body.is-admin .admin-controls { display: flex !important; }
        .fade-in { animation: fadeIn 0.6s ease-out forwards; opacity: 0; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="text-stone-800 bg-stone-50">

    <!-- PANEL LOGOWANIA -->
    <div id="login-screen" class="fixed inset-0 z-[9999] bg-stone-900/95 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-10 text-center animate-fade-in border-4 border-wood-600">
            <i class="fa-solid fa-user-shield text-wood-600 text-5xl mb-6"></i>
            <h2 class="text-2xl font-bold mb-2">Panel Administratora</h2>
            <p class="text-stone-400 text-sm mb-6">Zaloguj się, aby zarządzać swoją stroną</p>
            <form id="admin-login-form" class="space-y-4 text-left">
                <div class="space-y-1">
                    <label class="text-xs font-bold text-stone-500 uppercase">Login</label>
                    <input type="text" id="login-user" class="w-full border p-4 rounded-xl focus:ring-2 focus:ring-wood-500 outline-none transition" placeholder="admin">
                </div>
                <div class="space-y-1">
                    <label class="text-xs font-bold text-stone-500 uppercase">Hasło</label>
                    <input type="password" id="login-pass" class="w-full border p-4 rounded-xl focus:ring-2 focus:ring-wood-500 outline-none transition" placeholder="Wpisz hasło">
                </div>
                <div id="login-error" class="text-red-500 text-sm hidden font-bold text-center p-2 bg-red-50 rounded-lg">Błędne dane logowania!</div>
                <button type="submit" class="w-full bg-wood-600 text-white py-4 rounded-xl font-bold shadow-lg hover:bg-wood-700 transition transform active:scale-95">Zaloguj się</button>
            </form>
            <button id="exit-login-btn" class="mt-8 text-stone-400 hover:text-wood-600 transition underline text-sm">Wróć do strony głównej</button>
        </div>
    </div>

    <!-- PASEK ADMINA -->
    <div id="admin-bar" class="hidden bg-stone-900 text-white py-3 px-6 fixed top-0 w-full z-[150] flex justify-between items-center shadow-xl border-b border-wood-600">
        <div class="flex items-center gap-4">
            <div class="h-3 w-3 rounded-full bg-green-500 animate-pulse"></div>
            <span class="text-xs font-bold uppercase tracking-widest text-wood-100">Jesteś zalogowany jako Admin</span>
        </div>
        <div class="flex gap-4">
            <button id="toggle-admin-panel-btn" class="bg-wood-600 hover:bg-wood-500 px-5 py-2 rounded-lg text-xs font-bold transition flex items-center gap-2 shadow-lg">
                <i class="fa-solid fa-gears"></i> Menu Zarządzania
            </button>
            <button id="logout-btn" class="text-xs bg-stone-800 px-4 py-2 rounded-lg hover:bg-red-900 transition border border-white/10">Wyloguj</button>
        </div>
    </div>

    <!-- NAWIGACJA -->
    <nav class="fixed w-full z-50 bg-white/95 backdrop-blur-md shadow-sm top-0 h-24 flex items-center" id="main-nav">
        <div class="max-w-7xl mx-auto px-6 w-full flex justify-between items-center">
            <a href="#" id="logo-link" class="text-2xl font-bold text-wood-900 flex items-center gap-3">
                <div class="bg-wood-600 p-2 rounded-lg text-white">
                    <i class="fa-solid fa-bolt"></i>
                </div>
                <span>Xeomsc LaserHeat Art</span>
            </a>
            <div class="hidden lg:flex gap-10 items-center font-semibold text-stone-600">
                <a href="#home" class="hover:text-wood-600 transition">Start</a>
                <a href="#about" class="hover:text-wood-600 transition">Oferta</a>
                <a href="#process" class="hover:text-wood-600 transition">Proces</a>
                <a href="#portfolio" class="hover:text-wood-600 transition text-wood-600">Realizacje</a>
                <a href="#contact" class="bg-wood-600 text-white px-8 py-3 rounded-full shadow-lg hover:bg-wood-800 transition">Wycena</a>
            </div>
        </div>
    </nav>

    <!-- KONTENER GŁÓWNY -->
    <div id="main-content">
        <!-- Hero Section -->
        <section id="home" class="relative h-screen flex items-center hero-bg overflow-hidden pt-20">
            <div class="absolute inset-0 z-0" id="hero-carousel-container"></div>
            <div class="absolute inset-0 bg-stone-900/40 z-10 pointer-events-none"></div>
            <div class="max-w-7xl mx-auto px-6 relative z-20 w-full">
                <div class="max-w-2xl text-center md:text-left">
                    <span class="inline-block py-1.5 px-4 rounded-full bg-wood-100 text-wood-800 text-xs font-bold mb-6 uppercase tracking-widest">Twoja wyobraźnia, nasz laser</span>
                    <h1 class="text-5xl md:text-7xl font-bold text-white text-outline leading-tight mb-6">
                        Precyzja Lasera,<br>Ciepło <span class="gradient-text">Drewna</span>.
                    </h1>
                    <p class="text-xl text-white text-outline mb-10 font-light opacity-90 leading-relaxed">Pracownia Xeomsc LaserHeat Art. Tworzymy pamiątki, dekoracje i gadżety reklamowe, które zostają z Tobą na lata.</p>
                    <div class="flex flex-wrap gap-4 justify-center md:justify-start">
                        <a href="#portfolio" class="bg-wood-600 text-white px-10 py-4 rounded-full font-bold shadow-2xl hover:bg-wood-800 transition transform hover:scale-105">Zobacz nasze prace</a>
                        <a href="#contact" class="bg-white text-stone-900 px-10 py-4 rounded-full font-bold shadow-xl hover:bg-stone-100 transition">Wycena projektu</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sekcja Oferta -->
        <section id="about" class="py-24 bg-white">
            <div class="max-w-7xl mx-auto px-6">
                <div class="text-center mb-16">
                    <h2 class="text-4xl font-bold mb-4">Co oferuję?</h2>
                    <div class="w-20 h-1.5 bg-wood-600 mx-auto rounded-full"></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-12">
                    <div class="p-10 bg-stone-50 rounded-[2.5rem] border border-stone-100 hover:shadow-2xl transition-all group">
                        <div class="w-16 h-16 bg-wood-100 text-wood-600 rounded-2xl flex items-center justify-center mb-8 group-hover:bg-wood-600 group-hover:text-white transition-colors">
                            <i class="fa-solid fa-wand-magic-sparkles text-3xl"></i>
                        </div>
                        <h3 class="font-bold text-2xl mb-4 text-stone-900">Grawerowanie</h3>
                        <p class="text-stone-500 leading-relaxed">Nanoszenie grafiki i tekstu na drewno, szkło i materiały organiczne. Personalizacja prezentów i znakowanie firmowe.</p>
                    </div>
                    <div class="p-10 bg-stone-50 rounded-[2.5rem] border border-stone-100 hover:shadow-2xl transition-all group">
                        <div class="w-16 h-16 bg-wood-100 text-wood-600 rounded-2xl flex items-center justify-center mb-8 group-hover:bg-wood-600 group-hover:text-white transition-colors">
                            <i class="fa-solid fa-scissors text-3xl"></i>
                        </div>
                        <h3 class="font-bold text-2xl mb-4 text-stone-900">Precyzyjne Cięcie</h3>
                        <p class="text-stone-500 leading-relaxed">Wycinanie skomplikowanych kształtów ze sklejki, pleksi i innych materiałów do grubości 6-8mm. Toppery, napisy, puzzle.</p>
                    </div>
                    <div class="p-10 bg-stone-50 rounded-[2.5rem] border border-stone-100 hover:shadow-2xl transition-all group">
                        <div class="w-16 h-16 bg-wood-100 text-wood-600 rounded-2xl flex items-center justify-center mb-8 group-hover:bg-wood-600 group-hover:text-white transition-colors">
                            <i class="fa-solid fa-gift text-3xl"></i>
                        </div>
                        <h3 class="font-bold text-2xl mb-4 text-stone-900">Pamiątki i Prezenty</h3>
                        <p class="text-stone-500 leading-relaxed">Personalizowane tabliczki ślubne, pamiątki chrztu, podziękowania dla rodziców i unikalne dekoracje domowe.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Proces Zamówienia -->
        <section id="process" class="py-24 bg-stone-50">
            <div class="max-w-7xl mx-auto px-6 text-center">
                <h2 class="text-4xl font-bold mb-16 text-stone-900">Twoje zamówienie krok po kroku</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                    <div class="relative bg-white p-10 rounded-3xl border border-stone-100 shadow-sm flex flex-col items-center group">
                        <div class="text-4xl font-black text-stone-100 mb-4 group-hover:text-wood-600 transition-colors">01</div>
                        <h4 class="font-bold text-lg mb-2 text-stone-900">Pomysł</h4>
                        <p class="text-xs text-stone-400">Prześlij nam swój pomysł lub gotowy plik.</p>
                    </div>
                    <div class="relative bg-white p-10 rounded-3xl border border-stone-100 shadow-sm flex flex-col items-center group">
                        <div class="text-4xl font-black text-stone-100 mb-4 group-hover:text-wood-600 transition-colors">02</div>
                        <h4 class="font-bold text-lg mb-2 text-stone-900">Wycena</h4>
                        <p class="text-xs text-stone-400">Przygotujemy kalkulację na podstawie projektu.</p>
                    </div>
                    <div class="relative bg-white p-10 rounded-3xl border border-stone-100 shadow-sm flex flex-col items-center group">
                        <div class="text-4xl font-black text-stone-100 mb-4 group-hover:text-wood-600 transition-colors">03</div>
                        <h4 class="font-bold text-lg mb-2 text-stone-900">Laser</h4>
                        <p class="text-xs text-stone-400">Wycinamy i grawerujemy Twoje zlecenie.</p>
                    </div>
                    <div class="relative bg-white p-10 rounded-3xl border border-stone-100 shadow-sm flex flex-col items-center group">
                        <div class="text-4xl font-black text-stone-100 mb-4 group-hover:text-wood-600 transition-colors">04</div>
                        <h4 class="font-bold text-lg mb-2 text-stone-900">Gotowe</h4>
                        <p class="text-xs text-stone-400">Odbierasz produkt osobiście lub kurierem.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Portfolio Grid -->
        <section id="portfolio" class="py-24 bg-white">
            <div class="max-w-7xl mx-auto px-6 text-center">
                <h2 class="text-4xl font-bold mb-4 text-stone-900">Wybrane Realizacje</h2>
                <div class="w-20 h-1.5 bg-wood-600 mx-auto rounded-full mb-16"></div>
                <div id="main-categories-grid" class="grid grid-cols-1 md:grid-cols-3 gap-10 text-left"></div>
            </div>
        </section>

        <!-- Kontakt -->
        <section id="contact" class="py-24 bg-stone-900 text-white">
            <div class="max-w-5xl mx-auto px-6 text-center">
                <h2 class="text-4xl font-bold mb-12">Zrealizujmy Twój projekt</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                    <div class="bg-stone-800 p-10 rounded-[2rem] border border-white/5 flex flex-col items-center">
                        <div class="w-16 h-16 bg-wood-600 text-white rounded-full flex items-center justify-center mb-6 text-2xl shadow-xl"><i class="fa-solid fa-envelope"></i></div>
                        <h4 class="text-xl font-bold mb-2 uppercase tracking-widest text-stone-400">E-mail</h4>
                        <p class="text-white font-bold text-lg">pkatlowski@gmail.com</p>
                    </div>
                    <div class="bg-stone-800 p-10 rounded-[2rem] border border-white/5 flex flex-col items-center">
                        <div class="w-16 h-16 bg-white text-stone-900 rounded-full flex items-center justify-center mb-6 text-2xl shadow-xl"><i class="fa-solid fa-phone"></i></div>
                        <h4 class="text-xl font-bold mb-2 uppercase tracking-widest text-stone-400">Telefon</h4>
                        <p class="text-white font-bold text-lg">+48 123 456 789</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- PODSTRONY (MODALE) -->
    <div id="subcategory-view" class="hidden min-h-screen pt-32 pb-20 fade-in bg-white fixed inset-0 z-[100] overflow-y-auto">
        <div class="max-w-7xl mx-auto px-6">
            <button onclick="window.goHome()" class="mb-10 flex items-center gap-2 font-bold text-wood-600 hover:translate-x-[-5px] transition-transform bg-stone-100 px-6 py-2 rounded-full"><i class="fa-solid fa-arrow-left"></i> Powrót do strony głównej</button>
            <h2 id="subcategory-title" class="text-5xl font-bold mb-12 text-stone-900"></h2>
            <div id="subcategory-grid" class="grid grid-cols-1 md:grid-cols-3 gap-10"></div>
        </div>
    </div>

    <div id="gallery-view" class="hidden min-h-screen pt-32 pb-20 fade-in bg-white fixed inset-0 z-[110] overflow-y-auto">
        <div class="max-w-7xl mx-auto px-6 text-center">
            <button id="back-to-sub-btn" class="mb-10 flex items-center gap-2 font-bold text-wood-600 hover:translate-x-[-5px] transition-transform bg-stone-100 px-6 py-2 rounded-full"><i class="fa-solid fa-arrow-left"></i> Powrót do listy produktów</button>
            <h2 id="gallery-title" class="text-4xl font-bold mb-12 text-stone-900"></h2>
            <div id="gallery-grid" class="grid grid-cols-2 md:grid-cols-4 gap-6"></div>
        </div>
    </div>

    <!-- LIGHTBOX -->
    <div id="lightbox" class="fixed inset-0 z-[1000] bg-black/95 hidden items-center justify-center p-4">
        <img id="lightbox-img" src="" class="max-h-full max-w-full rounded-lg shadow-2xl">
        <button id="close-lightbox-btn" class="absolute top-8 right-8 text-white text-5xl hover:text-wood-500 transition"><i class="fa-solid fa-xmark"></i></button>
    </div>

    <!-- PANEL STEROWANIA CMS -->
    <div id="admin-panel" class="fixed inset-0 z-[2000] bg-stone-900/90 backdrop-blur-md hidden items-center justify-center p-6">
        <div class="bg-stone-900 text-white w-full max-w-6xl h-[85vh] rounded-[2rem] overflow-hidden flex flex-col md:flex-row shadow-2xl border border-white/10">
            <div class="w-full md:w-72 bg-black/40 p-8 flex flex-col border-r border-white/5">
                <h3 class="text-2xl font-bold mb-10 text-wood-500 flex items-center gap-2"><i class="fa-solid fa-screwdriver-wrench"></i> CMS</h3>
                <nav class="space-y-3 flex-1">
                    <button id="btn-hero-gallery" class="admin-sidebar-item w-full text-left px-5 py-3 rounded-xl transition font-semibold hover:bg-white/5">Główny Baner</button>
                    <button id="btn-categories" class="admin-sidebar-item w-full text-left px-5 py-3 rounded-xl transition font-semibold hover:bg-white/5">Kategorie Prac</button>
                    <button id="btn-products" class="admin-sidebar-item w-full text-left px-5 py-3 rounded-xl transition font-semibold hover:bg-white/5">Realizacje (Zdjęcia)</button>
                    <button id="btn-calculator" class="admin-sidebar-item w-full text-left px-5 py-3 rounded-xl transition font-semibold hover:bg-white/5">Cennik Kalkulatora</button>
                </nav>
                <button id="close-admin-panel-btn" class="mt-8 text-sm text-stone-500 hover:text-white transition underline">Zamknij panel</button>
            </div>
            <div class="flex-1 p-10 overflow-y-auto" id="admin-view-container"></div>
        </div>
    </div>

    <!-- STOPKA -->
    <footer class="bg-stone-950 text-stone-500 py-16 text-center border-t border-white/5">
        <div class="max-w-7xl mx-auto px-6 grid grid-cols-1 md:grid-cols-2 gap-12 text-left mb-12">
            <div>
                <h4 class="text-white font-bold mb-6 text-lg">Xeomsc LaserHeat Art</h4>
                <p class="text-sm opacity-60">Grawerujemy Twoje pomysły w najwyższej jakości. Odwiedź nas w pracowni lub zamów online z darmową wyceną.</p>
            </div>
            <div class="md:text-right">
                <h4 class="text-white font-bold mb-6 text-lg">Pracownia Grawerska</h4>
                <div class="flex flex-col gap-3 text-sm">
                    <span>Poniedziałek - Piątek: 08:00 - 16:00</span>
                    <span>Paweł Katłowski</span>
                </div>
            </div>
        </div>
        <div class="pt-8 border-t border-white/5 opacity-30 text-xs">
            &copy; 2024 Xeomsc LaserHeat Art. Wszystkie prawa zastrzeżone.
        </div>
    </footer>

    <!-- LOGIKA SYSTEMU -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = JSON.parse(__firebase_config || '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'xeomsc-laserheat-art';
        
        let db, auth, siteData = {};

        const initialData = {
            heroItems: [{ id: 1, type: 'image', url: 'https://images.unsplash.com/photo-1542332213-31f87348057f?q=80&w=2070' }],
            categories: {},
            galleries: {},
            calcSettings: { rateLaserMin: 0.50, rateCm2: 0.0038, overhead: 10, margin: 20 }
        };

        function renderHero() {
            const container = document.getElementById('hero-carousel-container');
            if (!container || !siteData.heroItems) return;
            container.innerHTML = siteData.heroItems.map((it, idx) => `
                <div class="hero-slide ${idx === 0 ? 'active' : ''}">
                    ${it.type === 'image' ? `<img src="${it.url}" class="w-full h-full object-cover">` : `<video src="${it.url}" class="w-full h-full object-cover" muted autoplay loop></video>`}
                </div>
            `).join('');
            
            let cur = 0;
            const carouselTimer = setInterval(() => {
                const slides = document.querySelectorAll('.hero-slide');
                if (slides.length < 2) return;
                slides[cur].classList.remove('active');
                cur = (cur + 1) % slides.length;
                slides[cur].classList.add('active');
            }, 6000);
        }

        function renderMain() {
            const grid = document.getElementById('main-categories-grid');
            if (!grid) return;
            grid.innerHTML = Object.entries(siteData.categories).map(([id, c]) => `
                <div class="group bg-white rounded-[2rem] overflow-hidden shadow-sm hover:shadow-2xl transition-all duration-500 cursor-pointer border border-stone-100 fade-in" onclick="window.openSub('${id}')">
                    <img src="${c.image || 'https://via.placeholder.com/400'}" class="h-64 w-full object-cover group-hover:scale-105 transition duration-500">
                    <div class="p-8">
                        <h3 class="font-bold text-xl mb-2 text-stone-900">${c.title}</h3>
                        <p class="text-stone-400 text-sm">Kliknij, aby zobaczyć realizacje.</p>
                    </div>
                </div>
            `).join('');
        }

        window.openSub = (id) => {
            const c = siteData.categories[id];
            if(!c) return;
            document.getElementById('subcategory-title').textContent = c.title;
            document.getElementById('subcategory-grid').innerHTML = c.subcategories.map((s, i) => `
                <div class="bg-white rounded-[2rem] overflow-hidden border border-stone-100 cursor-pointer hover:shadow-2xl transition relative" onclick="window.openGal('${s.id}', '${s.title}', '${id}')">
                    <img src="${s.image}" class="h-64 w-full object-cover">
                    <div class="p-6 flex justify-between items-center">
                        <span class="font-bold text-stone-900">${s.title}</span>
                        <button onclick="event.stopPropagation(); window.delSub('${id}',${i})" class="admin-controls text-red-500 p-2"><i class="fa-solid fa-trash"></i></button>
                    </div>
                </div>
            `).join('');
            document.getElementById('subcategory-view').classList.remove('hidden');
            window.scrollTo(0,0);
        };

        window.openGal = (sid, title, cid) => {
            const g = siteData.galleries[sid] || { images: [] };
            document.getElementById('gallery-title').textContent = title;
            document.getElementById('back-to-sub-btn').onclick = () => window.openSub(cid);
            document.getElementById('gallery-grid').innerHTML = g.images.map((img, i) => `
                <div class="relative aspect-square rounded-2xl overflow-hidden cursor-pointer shadow-lg group">
                    <img src="${img.src}" class="w-full h-full object-cover" onclick="window.openLightbox('${img.src}')">
                    <button onclick="window.delImg('${sid}',${i},'${cid}','${title}')" class="admin-controls absolute top-4 right-4 bg-red-500 text-white p-2 rounded-lg opacity-0 group-hover:opacity-100 transition"><i class="fa-solid fa-trash"></i></button>
                </div>
            `).join('');
            document.getElementById('gallery-view').classList.remove('hidden');
            window.scrollTo(0,0);
        };

        window.goHome = () => {
            document.getElementById('subcategory-view').classList.add('hidden');
            document.getElementById('gallery-view').classList.add('hidden');
            window.location.hash = '';
        };

        async function saveData() {
            localStorage.setItem('xeomsc_cached_data', JSON.stringify(siteData));
            if (auth.currentUser) {
                await setDoc(doc(db, `artifacts/${appId}/public/data/siteConfig`, 'main'), siteData);
            }
        }

        function renderAdminView(id) {
            const container = document.getElementById('admin-view-container');
            if (id === 'hero-gallery') {
                container.innerHTML = `
                    <h4 class="text-xl font-bold mb-6 text-wood-500">Banery Hero</h4>
                    <div class="bg-black/20 p-6 rounded-2xl space-y-4 mb-6">
                        <input id="h-url" class="calc-input" placeholder="URL Zdjęcia/Wideo">
                        <select id="h-type" class="calc-input text-white"><option value="image">Zdjęcie</option><option value="video">Wideo</option></select>
                        <button id="add-h-btn" class="bg-wood-600 w-full p-4 rounded-xl font-bold text-white shadow-lg">Dodaj</button>
                    </div>
                    <div class="space-y-2">${siteData.heroItems.map((h, i) => `<div class="bg-black/40 p-4 rounded-xl flex justify-between items-center text-xs opacity-60"><span>${h.url}</span><button onclick="window.delHero(${i})" class="text-red-500 p-2">USUŃ</button></div>`).join('')}</div>
                `;
                document.getElementById('add-h-btn').onclick = () => {
                    const url = document.getElementById('h-url').value;
                    if(url) { siteData.heroItems.push({type: document.getElementById('h-type').value, url}); saveData(); renderAdminView('hero-gallery'); }
                };
            } else if (id === 'calculator') {
                container.innerHTML = `
                    <h4 class="text-xl font-bold mb-6 text-wood-500">Koszty</h4>
                    <div class="space-y-6">
                        <div class="bg-black/20 p-6 rounded-2xl"><label class="text-[10px] text-stone-500 font-bold mb-2 block">Minuta lasera (PLN)</label><input id="rate-min" class="calc-input" value="${siteData.calcSettings.rateLaserMin}" type="number" step="0.01"></div>
                        <div class="bg-black/20 p-6 rounded-2xl"><label class="text-[10px] text-stone-500 font-bold mb-2 block">Materiał cm2 (PLN)</label><input id="rate-cm" class="calc-input" value="${siteData.calcSettings.rateCm2}" type="number" step="0.0001"></div>
                        <button id="save-calc-btn" class="bg-wood-600 w-full p-4 rounded-xl font-bold text-white shadow-xl">Zapisz</button>
                    </div>
                `;
                document.getElementById('save-calc-btn').onclick = () => {
                    siteData.calcSettings.rateLaserMin = parseFloat(document.getElementById('rate-min').value);
                    siteData.calcSettings.rateCm2 = parseFloat(document.getElementById('rate-cm').value);
                    saveData(); alert("Zapisano!");
                };
            } else if (id === 'categories') {
                container.innerHTML = `
                    <h4 class="text-xl font-bold mb-6 text-wood-500">Kategorie</h4>
                    <div class="bg-black/20 p-6 rounded-2xl space-y-4 mb-6"><input id="cat-t" class="calc-input" placeholder="Nazwa"><input id="cat-i" class="calc-input" placeholder="Okładka link"><button id="add-cat-btn" class="bg-wood-600 w-full p-4 rounded-xl font-bold text-white shadow-lg">Utwórz</button></div>
                    <div class="space-y-2 text-white">${Object.keys(siteData.categories).map(k => `<div class="bg-black/40 p-4 rounded-xl flex justify-between"><span>${siteData.categories[k].title}</span><button onclick="window.delCat('${k}')" class="text-red-500 font-bold">USUŃ</button></div>`).join('')}</div>
                `;
                document.getElementById('add-cat-btn').onclick = () => {
                    const t = document.getElementById('cat-t').value;
                    if(t) {
                        const id = 'c' + Date.now();
                        siteData.categories[id] = { title: t, image: document.getElementById('cat-i').value, subcategories: [] };
                        saveData(); renderAdminView('categories');
                    }
                };
            } else if (id === 'products') {
                container.innerHTML = `
                    <h4 class="text-xl font-bold mb-6 text-wood-500 text-white">Dodaj Produkt</h4>
                    <div class="bg-black/20 p-6 rounded-2xl space-y-4 mb-6"><select id="p-cat" class="calc-input text-white">${Object.keys(siteData.categories).map(k => `<option value="${k}">${siteData.categories[k].title}</option>`).join('')}</select><input id="p-t" class="calc-input" placeholder="Nazwa"><input id="p-i" class="calc-input" placeholder="Okładka"><button id="p-btn" class="bg-wood-600 w-full p-4 rounded-xl font-bold text-white shadow-xl">Dodaj</button></div>
                    <hr class="border-white/5 my-10"><h4 class="text-xl font-bold mb-4 text-white text-center">Dodaj zdjęcia do realizacji</h4><select id="p-gal-select" class="calc-input mb-4 text-white">${Object.keys(siteData.categories).flatMap(k => siteData.categories[k].subcategories.map(s => `<option value="${s.id}">${siteData.categories[k].title} > ${s.title}</option>`)).join('')}</select><input id="gal-img-url" class="calc-input mb-4" placeholder="Link do zdjęcia"><button id="gal-btn" class="bg-stone-600 w-full p-4 rounded-xl font-bold text-white shadow-xl">Dodaj zdjęcie</button>
                `;
                document.getElementById('p-btn').onclick = () => {
                    const cid = document.getElementById('p-cat').value;
                    const t = document.getElementById('p-t').value;
                    if(cid && t) {
                        const sid = 's' + Date.now();
                        siteData.categories[cid].subcategories.push({ id: sid, title: t, image: document.getElementById('p-i').value });
                        siteData.galleries[sid] = { images: [] };
                        saveData(); alert("Dodano produkt!"); renderAdminView('products');
                    }
                };
                document.getElementById('gal-btn').onclick = () => {
                    const sid = document.getElementById('p-gal-select').value;
                    const url = document.getElementById('gal-img-url').value;
                    if(sid && url) {
                        if(!siteData.galleries[sid]) siteData.galleries[sid] = { images: [] };
                        siteData.galleries[sid].images.push({ src: url });
                        saveData(); alert("Dodano zdjęcie!"); document.getElementById('gal-img-url').value = "";
                    }
                };
            }
        }

        window.delHero = (i) => { siteData.heroItems.splice(i,1); saveData(); renderAdminView('hero-gallery'); renderHero(); };
        window.delCat = (k) => { if(confirm("Usunąć kategorię?")) { delete siteData.categories[k]; saveData(); renderAdminView('categories'); renderMain(); }};
        window.delSub = (cid, i) => { if(confirm("Usunąć?")) { siteData.categories[cid].subcategories.splice(i,1); saveData(); window.openSub(cid); }};
        window.delImg = (sid, i, cid, t) => { if(confirm("Usunąć?")) { siteData.galleries[sid].images.splice(i,1); saveData(); window.openGal(sid, t, cid); }};
        window.openLightbox = (src) => { document.getElementById('lightbox-img').src = src; document.getElementById('lightbox').classList.replace('hidden','flex'); };
        document.getElementById('close-lightbox-btn').onclick = () => document.getElementById('lightbox').classList.replace('flex','hidden');

        async function start() {
            try {
                const appObj = initializeApp(firebaseConfig);
                auth = getAuth(appObj);
                db = getFirestore(appObj);
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) await signInWithCustomToken(auth, __initial_auth_token);
                else await signInAnonymously(auth);
                onAuthStateChanged(auth, (u) => {
                    if (u) {
                        const docRef = doc(db, `artifacts/${appId}/public/data/siteConfig`, 'main');
                        onSnapshot(docRef, (snap) => {
                            if (snap.exists()) {
                                siteData = snap.data();
                                localStorage.setItem('xeomsc_cached_data', JSON.stringify(siteData));
                                renderHero(); renderMain();
                            }
                        });
                        if (sessionStorage.getItem('xeomsc_admin') === 'true') {
                            document.body.classList.add('is-admin');
                            document.getElementById('admin-bar').classList.remove('hidden');
                        }
                    }
                });
            } catch (e) { renderHero(); renderMain(); }
        }

        document.getElementById('logo-link').onclick = (e) => { e.preventDefault(); window.goHome(); };
        document.getElementById('toggle-admin-panel-btn').onclick = () => { document.getElementById('admin-panel').classList.remove('hidden'); renderAdminView('hero-gallery'); };
        document.getElementById('close-admin-panel-btn').onclick = () => document.getElementById('admin-panel').classList.add('hidden');
        document.getElementById('admin-login-form').onsubmit = (e) => {
            e.preventDefault();
            if(document.getElementById('login-user').value === 'admin' && document.getElementById('login-pass').value === '12345') {
                sessionStorage.setItem('xeomsc_admin', 'true'); location.reload();
            } else document.getElementById('login-error').classList.remove('hidden');
        };
        document.getElementById('logout-btn').onclick = () => { sessionStorage.removeItem('xeomsc_admin'); location.reload(); };
        document.getElementById('exit-login-btn').onclick = () => { document.getElementById('login-screen').classList.add('hidden'); window.location.hash = ''; };
        ['hero-gallery', 'categories', 'products', 'calculator'].forEach(id => {
            const btn = document.getElementById(`btn-${id}`);
            if(btn) btn.onclick = () => renderAdminView(id);
        });
        window.addEventListener('hashchange', () => { if (window.location.hash === '#admin') document.getElementById('login-screen').classList.remove('hidden'); });
        siteData = JSON.parse(localStorage.getItem('xeomsc_cached_data')) || initialData;
        renderHero(); renderMain();
        start();
        if (window.location.hash === '#admin') document.getElementById('login-screen').classList.remove('hidden');
    </script>
</body>
</html>